<!doctypehtml><html class=no-js lang=zh-Hans><meta charset=utf-8><meta content=on http-equiv=x-dns-prefetch-control><link href=//oi-wiki.org rel=dns-prefetch><link href=//search.oi-wiki.org rel=dns-prefetch><link href=//api.github.com rel=dns-prefetch><link href=//www.google-analytics.com rel=dns-prefetch><meta content=width=device-width,initial-scale=1 name=viewport><meta content=ie=edge http-equiv=x-ua-compatible><meta content="OI Wiki 是一个编程竞赛知识整合站点，提供有趣又实用的编程竞赛知识以及其他有帮助的内容，帮助广大编程竞赛爱好者更快更深入地学习编程竞赛"name=description><link href=https://oi-wiki.org/misc/mo-algo-on-tree/ rel=canonical><meta content=S name=author><meta content=复制 name=lang:clipboard.copy><meta content=已复制 name=lang:clipboard.copied><meta content=jp name=lang:search.language><meta content=True name=lang:search.pipeline.stopwords><meta content=True name=lang:search.pipeline.trimmer><meta content=没有找到符合条件的结果 name=lang:search.result.none><meta content="找到 1 个符合条件的结果"name=lang:search.result.one><meta content="# 个符合条件的结果"name=lang:search.result.other><meta content=[\uff0c\u3002]+ name=lang:search.tokenizer><link rel="shortcut icon"href=../../favicon.ico><meta content="mkdocs-1.3.0, mkdocs-material-4.4.2"name=generator><title>树上莫队 - OI Wiki</title><link href=../../assets/stylesheets/application.6f7cfa25.css rel=stylesheet><link href=../../assets/stylesheets/application-palette.a8b3c06d.css rel=stylesheet><meta name=theme-color><script src=../../assets/javascripts/modernizr.27508f0e.js></script><style>@font-face {font-family:'Fira Sans';font-style:normal;font-weight:300;src:local('Fira Sans'),local('FiraSans-Normal'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-300.eot?#iefix) format('embedded-opentype'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-300.woff2) format('woff2'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-300.woff) format('woff'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-300.ttf) format('truetype'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-300.svg#FiraSans) format('svg')}@font-face {font-family:'Fira Sans';font-style:normal;font-weight:regular;src:local('Fira Sans'),local('FiraSans-Normal'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-regular.eot?#iefix) format('embedded-opentype'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-regular.woff2) format('woff2'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-regular.woff) format('woff'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-regular.ttf) format('truetype'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-regular.svg#FiraSans) format('svg')}@font-face {font-family:'Fira Sans';font-style:italic;font-weight:regular;src:local('Fira Sans'),local('FiraSans-Italic'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-italic.eot?#iefix) format('embedded-opentype'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-italic.woff2) format('woff2'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-italic.woff) format('woff'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-italic.ttf) format('truetype'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-italic.svg#FiraSans) format('svg')}@font-face {font-family:'Fira Sans';font-style:normal;font-weight:700;src:local('Fira Sans'),local('FiraSans-Normal'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-700.eot?#iefix) format('embedded-opentype'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-700.woff2) format('woff2'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-700.woff) format('woff'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-700.ttf) format('truetype'),url(//lib.baomitu.com/fonts/fira-sans/fira-sans-700.svg#FiraSans) format('svg')}@font-face {font-family:'Fira Mono';font-style:normal;font-weight:regular;src:local('Fira Mono'),local('FiraMono-Normal'),url(//lib.baomitu.com/fonts/fira-mono/fira-mono-regular.eot?#iefix) format('embedded-opentype'),url(//lib.baomitu.com/fonts/fira-mono/fira-mono-regular.woff2) format('woff2'),url(//lib.baomitu.com/fonts/fira-mono/fira-mono-regular.woff) format('woff'),url(//lib.baomitu.com/fonts/fira-mono/fira-mono-regular.ttf) format('truetype'),url(//lib.baomitu.com/fonts/fira-mono/fira-mono-regular.svg#FiraMono) format('svg')}body,input{font-family:"Fira Sans","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Fira Mono","Courier New",Courier,monospace}</style><link href=../../assets/vendor/material-icons/iconfont/material-icons.css rel=stylesheet><link href=../../manifest.webmanifest rel=manifest><link href=../../_static/css/extra.css?v=13 rel=stylesheet><script>window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-124485594-1", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })</script><script async src=https://www.google-analytics.com/analytics.js></script><style>.mjpage .MJX-monospace{font-family:monospace}.mjpage .MJX-sans-serif{font-family:sans-serif}.mjpage{display:inline;font-style:normal;font-weight:normal;line-height:normal;font-size:100%;font-size-adjust:none;text-indent:0;text-align:left;text-transform:none;letter-spacing:normal;word-spacing:normal;word-wrap:normal;white-space:nowrap;float:none;direction:ltr;max-width:none;max-height:none;min-width:0;min-height:0;border:0;padding:0;margin:0}.mjpage *{transition:none;-webkit-transition:none;-moz-transition:none;-ms-transition:none;-o-transition:none}.mjx-svg-href{fill:blue;stroke:blue}.MathJax_SVG_LineBox{display:table!important}.MathJax_SVG_LineBox span{display:table-cell!important;width:10000em!important;min-width:0;max-width:none;padding:0;border:0;margin:0}.mjpage__block{text-align:center;margin:1em 0em;position:relative;display:block!important;text-indent:0;max-width:none;max-height:none;min-width:0;min-height:0;width:100%}</style></head><body data-md-color-accent=red data-md-color-primary=white dir=ltr><svg class=md-svg><defs><svg viewbox="0 0 416 448"height=448 id=__github width=416 xmlns=http://www.w3.org/2000/svg><path d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"fill=currentColor></path></svg></defs></svg><input autocomplete=off class=md-toggle data-md-toggle=drawer id=__drawer type=checkbox><input autocomplete=off class=md-toggle data-md-toggle=search id=__search type=checkbox><label class=md-overlay data-md-component=overlay for=__drawer></label><a class=md-skip href=#_1 tabindex=1> 跳转至 </a><header class=md-header data-md-component=header><nav class="md-header-nav md-grid"><div class=md-flex><div class="md-flex__cell md-flex__cell--shrink"><a class="md-header-nav__button md-logo"title="OI Wiki"href=https://oi-wiki.org/> <i class=md-icon>school</i> </a></div><div class="md-flex__cell md-flex__cell--shrink"><label class="md-icon md-icon--menu md-header-nav__button"for=__drawer></label></div><div class="md-flex__cell md-flex__cell--stretch"><div class="md-flex__ellipsis md-header-nav__title"data-md-component=title><span class=md-header-nav__topic> OI Wiki </span><span class=md-header-nav__topic> 树上莫队 </span></div></div><div class="md-flex__cell md-flex__cell--shrink"><label class="md-icon md-icon--search md-header-nav__button"for=__search></label><div class=md-search data-md-component=search role=dialog><label class=md-search__overlay for=__search></label><div class=md-search__inner role=search><form class=md-search__form name=search><input autocapitalize=off autocomplete=off autocorrect=off class=md-search__input data-md-component=query data-md-state=active name=query placeholder=搜索 spellcheck=false><label class="md-icon md-search__icon"for=__search></label><button class="md-icon md-search__icon"data-md-component=reset tabindex=-1 type=reset></button></form><div class=md-search__output><div class=md-search__scrollwrap data-md-scrollfix><div class=md-search-result data-md-component=result><div class=md-search-result__meta>键入以开始搜索</div><ol class=md-search-result__list></ol></div></div></div></div></div></div><div class="md-flex__cell md-flex__cell--shrink"><div class=md-header-nav__source><a title="前往 Github 仓库"class=md-source data-md-source=github href=https://github.com/OI-wiki/OI-wiki> <div class=md-source__icon><svg viewbox="0 0 24 24"height=24 width=24><use height=24 width=24 xlink:href=#__github></use></svg></div> <div class=md-source__repository>OI-wiki/OI-wiki</div> </a></div></div></div></nav></header><div class=md-container><nav class="md-tabs md-tabs--active"data-md-component=tabs><div class="md-tabs__inner md-grid"><ul class=md-tabs__list><li class=md-tabs__item><a class=md-tabs__link href=../..> 简介 </a></li><li class=md-tabs__item><a class=md-tabs__link href=../../contest/> 比赛相关 </a></li><li class=md-tabs__item><a class=md-tabs__link href=../../tools/> 工具软件 </a></li><li class=md-tabs__item><a class=md-tabs__link href=../../lang/> 语言基础 </a></li><li class=md-tabs__item><a class=md-tabs__link href=../../basic/> 算法基础 </a></li><li class=md-tabs__item><a class=md-tabs__link href=../../search/> 搜索 </a></li><li class=md-tabs__item><a class=md-tabs__link href=../../dp/> 动态规划 </a></li><li class=md-tabs__item><a class=md-tabs__link href=../../string/> 字符串 </a></li><li class=md-tabs__item><a class=md-tabs__link href=../../math/> 数学 </a></li><li class=md-tabs__item><a class=md-tabs__link href=../../ds/> 数据结构 </a></li><li class=md-tabs__item><a class=md-tabs__link href=../../graph/> 图论 </a></li><li class=md-tabs__item><a class=md-tabs__link href=../../geometry/> 计算几何 </a></li><li class=md-tabs__item><a class="md-tabs__link md-tabs__link--active"href=../> 杂项 </a></li><li class=md-tabs__item><a class=md-tabs__link href=../../topic/rmq/> 专题 </a></li><li class=md-tabs__item><a class=md-tabs__link href=../../intro/hulu/> 关于 Hulu </a></li></ul></div></nav><main class=md-main role=main><div class="md-main__inner md-grid"data-md-component=container><div class="md-sidebar md-sidebar--primary"data-md-component=navigation><div class=md-sidebar__scrollwrap><div class=md-sidebar__inner><nav class="md-nav md-nav--primary"data-md-level=0><label class="md-nav__title md-nav__title--site"for=__drawer><a class="md-nav__button md-logo"title="OI Wiki"href=https://oi-wiki.org/> <i class=md-icon>school</i> </a> OI Wiki</label><div class=md-nav__source><a title="前往 Github 仓库"class=md-source data-md-source=github href=https://github.com/OI-wiki/OI-wiki> <div class=md-source__icon><svg viewbox="0 0 24 24"height=24 width=24><use height=24 width=24 xlink:href=#__github></use></svg></div> <div class=md-source__repository>OI-wiki/OI-wiki</div> </a></div><ul class=md-nav__list data-md-scrollfix><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle"data-md-toggle=nav-1 id=nav-1 type=checkbox> <label class=md-nav__link for=nav-1>简介</label> <nav class=md-nav data-md-component=collapsible data-md-level=1><label class=md-nav__title for=nav-1>简介</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a title="Getting Started"class=md-nav__link href=../..> Getting Started </a></li><li class=md-nav__item><a class=md-nav__link href=../../intro/about/ title=关于本项目> 关于本项目 </a></li><li class=md-nav__item><a class=md-nav__link href=../../intro/htc/ title=如何参与> 如何参与 </a></li><li class=md-nav__item><a class=md-nav__link href=../../intro/format/ title=格式手册> 格式手册 </a></li><li class=md-nav__item><a class=md-nav__link href=../../intro/faq/ title=F.A.Q.> F.A.Q. </a></li><li class=md-nav__item><a title="用 Docker 部署 OI Wiki"class=md-nav__link href=../../intro/docker-deploy/> 用 Docker 部署 OI Wiki </a></li><li class=md-nav__item><a class=md-nav__link href=../../intro/mirrors/ title=镜像站列表> 镜像站列表 </a></li><li class=md-nav__item><a class=md-nav__link href=../../intro/thanks/ title=致谢> 致谢 </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle"data-md-toggle=nav-2 id=nav-2 type=checkbox> <label class=md-nav__link for=nav-2>比赛相关</label> <nav class=md-nav data-md-component=collapsible data-md-level=1><label class=md-nav__title for=nav-2>比赛相关</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../contest/ title=比赛相关简介> 比赛相关简介 </a></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle"data-md-toggle=nav-2-2 id=nav-2-2 type=checkbox> <label class=md-nav__link for=nav-2-2>赛事</label> <nav class=md-nav data-md-component=collapsible data-md-level=2><label class=md-nav__title for=nav-2-2>赛事</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a title="OI 赛事与赛制"class=md-nav__link href=../../contest/oi/> OI 赛事与赛制 </a></li><li class=md-nav__item><a title="ICPC/CCPC 赛事与赛制"class=md-nav__link href=../../contest/icpc/> ICPC/CCPC 赛事与赛制 </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle"data-md-toggle=nav-2-3 id=nav-2-3 type=checkbox> <label class=md-nav__link for=nav-2-3>题型</label> <nav class=md-nav data-md-component=collapsible data-md-level=2><label class=md-nav__title for=nav-2-3>题型</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../contest/problems/ title=题型概述> 题型概述 </a></li><li class=md-nav__item><a class=md-nav__link href=../../contest/interaction/ title=交互题> 交互题 </a></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=../../contest/roadmap/ title=学习路线> 学习路线 </a></li><li class=md-nav__item><a class=md-nav__link href=../../contest/resources/ title=学习资源> 学习资源 </a></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle"data-md-toggle=nav-2-6 id=nav-2-6 type=checkbox> <label class=md-nav__link for=nav-2-6>技巧</label> <nav class=md-nav data-md-component=collapsible data-md-level=2><label class=md-nav__title for=nav-2-6>技巧</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../contest/io/ title=读入、输出优化> 读入、输出优化 </a></li><li class=md-nav__item><a class=md-nav__link href=../../contest/common-mistakes/ title=常见错误> 常见错误 </a></li><li class=md-nav__item><a class=md-nav__link href=../../contest/common-tricks/ title=常见技巧> 常见技巧 </a></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=../../contest/problemsetting/ title=出题> 出题 </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle"data-md-toggle=nav-3 id=nav-3 type=checkbox> <label class=md-nav__link for=nav-3>工具软件</label> <nav class=md-nav data-md-component=collapsible data-md-level=1><label class=md-nav__title for=nav-3>工具软件</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../tools/ title=工具软件简介> 工具软件简介 </a></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle"data-md-toggle=nav-3-2 id=nav-3-2 type=checkbox> <label class=md-nav__link for=nav-3-2>代码编辑工具</label> <nav class=md-nav data-md-component=collapsible data-md-level=2><label class=md-nav__title for=nav-3-2>代码编辑工具</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../tools/editor/vim/ title=Vim> Vim </a></li><li class=md-nav__item><a class=md-nav__link href=../../tools/editor/emacs/ title=Emacs> Emacs </a></li><li class=md-nav__item><a title="VS Code"class=md-nav__link href=../../tools/editor/vscode/> VS Code </a></li><li class=md-nav__item><a class=md-nav__link href=../../tools/editor/atom/ title=Atom> Atom </a></li><li class=md-nav__item><a class=md-nav__link href=../../tools/editor/eclipse/ title=Eclipse> Eclipse </a></li><li class=md-nav__item><a class=md-nav__link href=../../tools/editor/npp/ title=Notepad++> Notepad++ </a></li><li class=md-nav__item><a class=md-nav__link href=../../tools/editor/kate/ title=Kate> Kate </a></li><li class=md-nav__item><a class=md-nav__link href=../../tools/editor/devcpp/ title=Dev-C++> Dev-C++ </a></li><li class=md-nav__item><a class=md-nav__link href=../../tools/editor/geany/ title=Geany> Geany </a></li><li class=md-nav__item><a class=md-nav__link href=../../tools/editor/xcode/ title=Xcode> Xcode </a></li><li class=md-nav__item><a class=md-nav__link href=../../tools/editor/guide/ title=GUIDE> GUIDE </a></li><li class=md-nav__item><a title="Sublime Text"class=md-nav__link href=../../tools/editor/sublime/> Sublime Text </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle"data-md-toggle=nav-3-3 id=nav-3-3 type=checkbox> <label class=md-nav__link for=nav-3-3>评测工具</label> <nav class=md-nav data-md-component=collapsible data-md-level=2><label class=md-nav__title for=nav-3-3>评测工具</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../tools/judger/ title=评测工具简介> 评测工具简介 </a></li><li class=md-nav__item><a class=md-nav__link href=../../tools/judger/arbiter/ title=Arbiter> Arbiter </a></li><li class=md-nav__item><a class=md-nav__link href=../../tools/judger/cena/ title=Cena> Cena </a></li><li class=md-nav__item><a title="CCR Plus"class=md-nav__link href=../../tools/judger/ccr-plus/> CCR Plus </a></li><li class=md-nav__item><a class=md-nav__link href=../../tools/judger/lemon/ title=Lemon> Lemon </a></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=../../tools/cmd/ title=命令行> 命令行 </a></li><li class=md-nav__item><a title="WSL (Windows 10)"class=md-nav__link href=../../tools/wsl/> WSL (Windows 10) </a></li><li class=md-nav__item><a title="Special Judge"class=md-nav__link href=../../tools/special-judge/> Special Judge </a></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle"data-md-toggle=nav-3-7 id=nav-3-7 type=checkbox> <label class=md-nav__link for=nav-3-7>Testlib</label> <nav class=md-nav data-md-component=collapsible data-md-level=2><label class=md-nav__title for=nav-3-7>Testlib</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a title="Testlib 简介"class=md-nav__link href=../../tools/testlib/> Testlib 简介 </a></li><li class=md-nav__item><a class=md-nav__link href=../../tools/testlib/general/ title=通用> 通用 </a></li><li class=md-nav__item><a class=md-nav__link href=../../tools/testlib/generator/ title=Generator> Generator </a></li><li class=md-nav__item><a class=md-nav__link href=../../tools/testlib/validator/ title=Validator> Validator </a></li><li class=md-nav__item><a class=md-nav__link href=../../tools/testlib/interactor/ title=Interactor> Interactor </a></li><li class=md-nav__item><a class=md-nav__link href=../../tools/testlib/checker/ title=Checker> Checker </a></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=../../tools/polygon/ title=Polygon> Polygon </a></li><li class=md-nav__item><a title="OJ 工具"class=md-nav__link href=../../tools/oj-tool/> OJ 工具 </a></li><li class=md-nav__item><a title="LaTeX 入门"class=md-nav__link href=../../tools/latex/> LaTeX 入门 </a></li><li class=md-nav__item><a class=md-nav__link href=../../tools/git/ title=Git> Git </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle"data-md-toggle=nav-4 id=nav-4 type=checkbox> <label class=md-nav__link for=nav-4>语言基础</label> <nav class=md-nav data-md-component=collapsible data-md-level=1><label class=md-nav__title for=nav-4>语言基础</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../lang/ title=语言基础简介> 语言基础简介 </a></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle"data-md-toggle=nav-4-2 id=nav-4-2 type=checkbox> <label class=md-nav__link for=nav-4-2>C++ 基础</label> <nav class=md-nav data-md-component=collapsible data-md-level=2><label class=md-nav__title for=nav-4-2>C++ 基础</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a title="Hello, World!"class=md-nav__link href=../../lang/helloworld/> Hello, World! </a></li><li class=md-nav__item><a title="C++ 语法基础"class=md-nav__link href=../../lang/basic/> C++ 语法基础 </a></li><li class=md-nav__item><a class=md-nav__link href=../../lang/var/ title=变量> 变量 </a></li><li class=md-nav__item><a class=md-nav__link href=../../lang/op/ title=运算> 运算 </a></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle"data-md-toggle=nav-4-2-5 id=nav-4-2-5 type=checkbox> <label class=md-nav__link for=nav-4-2-5>流程控制语句</label> <nav class=md-nav data-md-component=collapsible data-md-level=3><label class=md-nav__title for=nav-4-2-5>流程控制语句</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../lang/branch/ title=分支> 分支 </a></li><li class=md-nav__item><a class=md-nav__link href=../../lang/loop/ title=循环> 循环 </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle"data-md-toggle=nav-4-2-6 id=nav-4-2-6 type=checkbox> <label class=md-nav__link for=nav-4-2-6>高级数据类型</label> <nav class=md-nav data-md-component=collapsible data-md-level=3><label class=md-nav__title for=nav-4-2-6>高级数据类型</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../lang/array/ title=数组> 数组 </a></li><li class=md-nav__item><a class=md-nav__link href=../../lang/struct/ title=结构体> 结构体 </a></li><li class=md-nav__item><a class=md-nav__link href=../../lang/pointer/ title=指针> 指针 </a></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=../../lang/func/ title=函数> 函数 </a></li><li class=md-nav__item><a class=md-nav__link href=../../lang/file-op/ title=文件操作> 文件操作 </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle"data-md-toggle=nav-4-3 id=nav-4-3 type=checkbox> <label class=md-nav__link for=nav-4-3>C++ 标准库</label> <nav class=md-nav data-md-component=collapsible data-md-level=2><label class=md-nav__title for=nav-4-3>C++ 标准库</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a title="C++ 标准库简介"class=md-nav__link href=../../lang/csl/> C++ 标准库简介 </a></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle"data-md-toggle=nav-4-3-2 id=nav-4-3-2 type=checkbox> <label class=md-nav__link for=nav-4-3-2>STL 容器</label> <nav class=md-nav data-md-component=collapsible data-md-level=3><label class=md-nav__title for=nav-4-3-2>STL 容器</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a title="STL 容器简介"class=md-nav__link href=../../lang/csl/container/> STL 容器简介 </a></li><li class=md-nav__item><a class=md-nav__link href=../../lang/csl/iterator/ title=迭代器> 迭代器 </a></li><li class=md-nav__item><a class=md-nav__link href=../../lang/csl/sequence-container/ title=序列式容器> 序列式容器 </a></li><li class=md-nav__item><a class=md-nav__link href=../../lang/csl/associative-container/ title=关联式容器> 关联式容器 </a></li><li class=md-nav__item><a class=md-nav__link href=../../lang/csl/unordered-container/ title=无序关联式容器> 无序关联式容器 </a></li><li class=md-nav__item><a class=md-nav__link href=../../lang/csl/container-adapter/ title=容器适配器> 容器适配器 </a></li></ul></nav></li><li class=md-nav__item><a title="STL 算法"class=md-nav__link href=../../lang/csl/algorithm/> STL 算法 </a></li><li class=md-nav__item><a class=md-nav__link href=../../lang/csl/bitset/ title=bitset> bitset </a></li><li class=md-nav__item><a class=md-nav__link href=../../lang/csl/string/ title=string> string </a></li><li class=md-nav__item><a class=md-nav__link href=../../lang/csl/pair/ title=pair> pair </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle"data-md-toggle=nav-4-4 id=nav-4-4 type=checkbox> <label class=md-nav__link for=nav-4-4>C++ 进阶</label> <nav class=md-nav data-md-component=collapsible data-md-level=2><label class=md-nav__title for=nav-4-4>C++ 进阶</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../lang/class/ title=类> 类 </a></li><li class=md-nav__item><a class=md-nav__link href=../../lang/namespace/ title=命名空间> 命名空间 </a></li><li class=md-nav__item><a class=md-nav__link href=../../lang/value-category/ title=值类别> 值类别 </a></li><li class=md-nav__item><a class=md-nav__link href=../../lang/op-overload/ title=重载运算符> 重载运算符 </a></li><li class=md-nav__item><a class=md-nav__link href=../../lang/reference/ title=引用> 引用 </a></li><li class=md-nav__item><a class=md-nav__link href=../../lang/const/ title=常值> 常值 </a></li><li class=md-nav__item><a title="新版 C++ 特性"class=md-nav__link href=../../lang/new/> 新版 C++ 特性 </a></li><li class=md-nav__item><a title="Lambda 表达式"class=md-nav__link href=../../lang/lambda/> Lambda 表达式 </a></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle"data-md-toggle=nav-4-4-9 id=nav-4-4-9 type=checkbox> <label class=md-nav__link for=nav-4-4-9>pb_ds</label> <nav class=md-nav data-md-component=collapsible data-md-level=3><label class=md-nav__title for=nav-4-4-9>pb_ds</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a title="pb_ds 简介"class=md-nav__link href=../../lang/pb-ds/> pb_ds 简介 </a></li><li class=md-nav__item><a class=md-nav__link href=../../lang/pb-ds/pq/ title=堆> 堆 </a></li><li class=md-nav__item><a class=md-nav__link href=../../lang/pb-ds/tree/ title=平衡树> 平衡树 </a></li></ul></nav></li></ul></nav></li><li class=md-nav__item><a title="C 与 C++ 区别"class=md-nav__link href=../../lang/cpp-other-langs/> C 与 C++ 区别 </a></li><li class=md-nav__item><a title="Pascal 转 C++ 急救"class=md-nav__link href=../../lang/pas-cpp/> Pascal 转 C++ 急救 </a></li><li class=md-nav__item><a title="Python 速成"class=md-nav__link href=../../lang/python/> Python 速成 </a></li><li class=md-nav__item><a title="Java 速成"class=md-nav__link href=../../lang/java/> Java 速成 </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle"data-md-toggle=nav-5 id=nav-5 type=checkbox> <label class=md-nav__link for=nav-5>算法基础</label> <nav class=md-nav data-md-component=collapsible data-md-level=1><label class=md-nav__title for=nav-5>算法基础</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../basic/ title=算法基础简介> 算法基础简介 </a></li><li class=md-nav__item><a class=md-nav__link href=../../basic/complexity/ title=复杂度> 复杂度 </a></li><li class=md-nav__item><a class=md-nav__link href=../../basic/enumerate/ title=枚举> 枚举 </a></li><li class=md-nav__item><a class=md-nav__link href=../../basic/simulate/ title=模拟> 模拟 </a></li><li class=md-nav__item><a title="递归 & 分治"class=md-nav__link href=../../basic/divide-and-conquer/> 递归 & 分治 </a></li><li class=md-nav__item><a class=md-nav__link href=../../basic/greedy/ title=贪心> 贪心 </a></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle"data-md-toggle=nav-5-7 id=nav-5-7 type=checkbox> <label class=md-nav__link for=nav-5-7>排序</label> <nav class=md-nav data-md-component=collapsible data-md-level=2><label class=md-nav__title for=nav-5-7>排序</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../basic/sort-intro/ title=排序简介> 排序简介 </a></li><li class=md-nav__item><a class=md-nav__link href=../../basic/selection-sort/ title=选择排序> 选择排序 </a></li><li class=md-nav__item><a class=md-nav__link href=../../basic/bubble-sort/ title=冒泡排序> 冒泡排序 </a></li><li class=md-nav__item><a class=md-nav__link href=../../basic/insertion-sort/ title=插入排序> 插入排序 </a></li><li class=md-nav__item><a class=md-nav__link href=../../basic/counting-sort/ title=计数排序> 计数排序 </a></li><li class=md-nav__item><a class=md-nav__link href=../../basic/radix-sort/ title=基数排序> 基数排序 </a></li><li class=md-nav__item><a class=md-nav__link href=../../basic/quick-sort/ title=快速排序> 快速排序 </a></li><li class=md-nav__item><a class=md-nav__link href=../../basic/merge-sort/ title=归并排序> 归并排序 </a></li><li class=md-nav__item><a class=md-nav__link href=../../basic/heap-sort/ title=堆排序> 堆排序 </a></li><li class=md-nav__item><a class=md-nav__link href=../../basic/bucket-sort/ title=桶排序> 桶排序 </a></li><li class=md-nav__item><a class=md-nav__link href=../../basic/shell-sort/ title=希尔排序> 希尔排序 </a></li><li class=md-nav__item><a class=md-nav__link href=../../basic/tournament-sort/ title=锦标赛排序> 锦标赛排序 </a></li><li class=md-nav__item><a title="排序相关 STL"class=md-nav__link href=../../basic/stl-sort/> 排序相关 STL </a></li><li class=md-nav__item><a class=md-nav__link href=../../basic/use-of-sort/ title=排序应用> 排序应用 </a></li></ul></nav></li><li class=md-nav__item><a title="前缀和 & 差分"class=md-nav__link href=../../basic/prefix-sum/> 前缀和 & 差分 </a></li><li class=md-nav__item><a class=md-nav__link href=../../basic/binary/ title=二分> 二分 </a></li><li class=md-nav__item><a class=md-nav__link href=../../basic/binary-lifting/ title=倍增> 倍增 </a></li><li class=md-nav__item><a class=md-nav__link href=../../basic/construction/ title=构造> 构造 </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle"data-md-toggle=nav-6 id=nav-6 type=checkbox> <label class=md-nav__link for=nav-6>搜索</label> <nav class=md-nav data-md-component=collapsible data-md-level=1><label class=md-nav__title for=nav-6>搜索</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../search/ title=搜索部分简介> 搜索部分简介 </a></li><li class=md-nav__item><a class=md-nav__link href=../../search/dfs/ title=DFS（搜索）> DFS（搜索） </a></li><li class=md-nav__item><a class=md-nav__link href=../../search/bfs/ title=BFS（搜索）> BFS（搜索） </a></li><li class=md-nav__item><a class=md-nav__link href=../../search/bidirectional/ title=双向搜索> 双向搜索 </a></li><li class=md-nav__item><a class=md-nav__link href=../../search/heuristic/ title=启发式搜索> 启发式搜索 </a></li><li class=md-nav__item><a class=md-nav__link href=../../search/astar/ title=A*> A* </a></li><li class=md-nav__item><a class=md-nav__link href=../../search/iterative/ title=迭代加深搜索> 迭代加深搜索 </a></li><li class=md-nav__item><a class=md-nav__link href=../../search/idastar/ title=IDA*> IDA* </a></li><li class=md-nav__item><a class=md-nav__link href=../../search/backtracking/ title=回溯法> 回溯法 </a></li><li class=md-nav__item><a title="Dancing Links"class=md-nav__link href=../../search/dlx/> Dancing Links </a></li><li class=md-nav__item><a title="Alpha-Beta 剪枝"class=md-nav__link href=../../search/alpha-beta/> Alpha-Beta 剪枝 </a></li><li class=md-nav__item><a class=md-nav__link href=../../search/opt/ title=优化> 优化 </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle"data-md-toggle=nav-7 id=nav-7 type=checkbox> <label class=md-nav__link for=nav-7>动态规划</label> <nav class=md-nav data-md-component=collapsible data-md-level=1><label class=md-nav__title for=nav-7>动态规划</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../dp/ title=动态规划部分简介> 动态规划部分简介 </a></li><li class=md-nav__item><a class=md-nav__link href=../../dp/basic/ title=动态规划基础> 动态规划基础 </a></li><li class=md-nav__item><a class=md-nav__link href=../../dp/memo/ title=记忆化搜索> 记忆化搜索 </a></li><li class=md-nav__item><a title="背包 DP"class=md-nav__link href=../../dp/knapsack/> 背包 DP </a></li><li class=md-nav__item><a title="区间 DP"class=md-nav__link href=../../dp/interval/> 区间 DP </a></li><li class=md-nav__item><a title="DAG 上的 DP"class=md-nav__link href=../../dp/dag/> DAG 上的 DP </a></li><li class=md-nav__item><a title="树形 DP"class=md-nav__link href=../../dp/tree/> 树形 DP </a></li><li class=md-nav__item><a title="状压 DP"class=md-nav__link href=../../dp/state/> 状压 DP </a></li><li class=md-nav__item><a title="数位 DP"class=md-nav__link href=../../dp/number/> 数位 DP </a></li><li class=md-nav__item><a title="插头 DP"class=md-nav__link href=../../dp/plug/> 插头 DP </a></li><li class=md-nav__item><a title="计数 DP"class=md-nav__link href=../../dp/count/> 计数 DP </a></li><li class=md-nav__item><a title="动态 DP"class=md-nav__link href=../../dp/dynamic/> 动态 DP </a></li><li class=md-nav__item><a title="概率 DP"class=md-nav__link href=../../dp/probability/> 概率 DP </a></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle"data-md-toggle=nav-7-14 id=nav-7-14 type=checkbox> <label class=md-nav__link for=nav-7-14>DP 优化</label> <nav class=md-nav data-md-component=collapsible data-md-level=2><label class=md-nav__title for=nav-7-14>DP 优化</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../dp/opt/monotonous-queue-stack/ title=单调队列/单调栈优化> 单调队列/单调栈优化 </a></li><li class=md-nav__item><a class=md-nav__link href=../../dp/opt/slope/ title=斜率优化> 斜率优化 </a></li><li class=md-nav__item><a class=md-nav__link href=../../dp/opt/quadrangle/ title=四边形不等式优化> 四边形不等式优化 </a></li><li class=md-nav__item><a class=md-nav__link href=../../dp/opt/state/ title=状态设计优化> 状态设计优化 </a></li></ul></nav></li><li class=md-nav__item><a title="其它 DP 方法"class=md-nav__link href=../../dp/misc/> 其它 DP 方法 </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle"data-md-toggle=nav-8 id=nav-8 type=checkbox> <label class=md-nav__link for=nav-8>字符串</label> <nav class=md-nav data-md-component=collapsible data-md-level=1><label class=md-nav__title for=nav-8>字符串</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../string/ title=字符串部分简介> 字符串部分简介 </a></li><li class=md-nav__item><a class=md-nav__link href=../../string/basic/ title=字符串基础> 字符串基础 </a></li><li class=md-nav__item><a class=md-nav__link href=../../string/lib-func/ title=标准库> 标准库 </a></li><li class=md-nav__item><a class=md-nav__link href=../../string/match/ title=字符串匹配> 字符串匹配 </a></li><li class=md-nav__item><a class=md-nav__link href=../../string/hash/ title=字符串哈希> 字符串哈希 </a></li><li class=md-nav__item><a title="字典树 (Trie)"class=md-nav__link href=../../string/trie/> 字典树 (Trie) </a></li><li class=md-nav__item><a title="前缀函数与 KMP 算法"class=md-nav__link href=../../string/kmp/> 前缀函数与 KMP 算法 </a></li><li class=md-nav__item><a title="Boyer-Moore 算法"class=md-nav__link href=../../string/bm/> Boyer-Moore 算法 </a></li><li class=md-nav__item><a title="Z 函数（扩展 KMP）"class=md-nav__link href=../../string/z-func/> Z 函数（扩展 KMP） </a></li><li class=md-nav__item><a class=md-nav__link href=../../string/automaton/ title=自动机> 自动机 </a></li><li class=md-nav__item><a title="AC 自动机"class=md-nav__link href=../../string/ac-automaton/> AC 自动机 </a></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle"data-md-toggle=nav-8-12 id=nav-8-12 type=checkbox> <label class=md-nav__link for=nav-8-12>后缀数组 (SA)</label> <nav class=md-nav data-md-component=collapsible data-md-level=2><label class=md-nav__title for=nav-8-12>后缀数组 (SA)</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../string/sa/ title=后缀数组简介> 后缀数组简介 </a></li><li class=md-nav__item><a class=md-nav__link href=../../string/sa-optimal-inplace/ title=最优原地后缀排序算法> 最优原地后缀排序算法 </a></li></ul></nav></li><li class=md-nav__item><a title="后缀自动机 (SAM)"class=md-nav__link href=../../string/sam/> 后缀自动机 (SAM) </a></li><li class=md-nav__item><a class=md-nav__link href=../../string/suffix-bst/ title=后缀平衡树> 后缀平衡树 </a></li><li class=md-nav__item><a class=md-nav__link href=../../string/general-sam/ title=广义后缀自动机> 广义后缀自动机 </a></li><li class=md-nav__item><a class=md-nav__link href=../../string/suffix-tree/ title=后缀树> 后缀树 </a></li><li class=md-nav__item><a class=md-nav__link href=../../string/manacher/ title=Manacher> Manacher </a></li><li class=md-nav__item><a class=md-nav__link href=../../string/pam/ title=回文树> 回文树 </a></li><li class=md-nav__item><a class=md-nav__link href=../../string/seq-automaton/ title=序列自动机> 序列自动机 </a></li><li class=md-nav__item><a class=md-nav__link href=../../string/minimal-string/ title=最小表示法> 最小表示法 </a></li><li class=md-nav__item><a title="Lyndon 分解"class=md-nav__link href=../../string/lyndon/> Lyndon 分解 </a></li><li class=md-nav__item><a title="Main-Lorentz 算法"class=md-nav__link href=../../string/main-lorentz/> Main-Lorentz 算法 </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle"data-md-toggle=nav-9 id=nav-9 type=checkbox> <label class=md-nav__link for=nav-9>数学</label> <nav class=md-nav data-md-component=collapsible data-md-level=1><label class=md-nav__title for=nav-9>数学</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../math/ title=数学部分简介> 数学部分简介 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/notation/ title=符号> 符号 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/complex/ title=复数> 复数 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/bit/ title=位运算> 位运算 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/quick-pow/ title=快速幂> 快速幂 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/base/ title=进位制> 进位制 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/bignum/ title=高精度计算> 高精度计算 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/balanced-ternary/ title=平衡三进制> 平衡三进制 </a></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle"data-md-toggle=nav-9-9 id=nav-9-9 type=checkbox> <label class=md-nav__link for=nav-9-9>数论</label> <nav class=md-nav data-md-component=collapsible data-md-level=2><label class=md-nav__title for=nav-9-9>数论</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/basic/ title=数论基础> 数论基础 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/prime/ title=素数> 素数 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/gcd/ title=最大公约数> 最大公约数 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/sqrt-decomposition/ title=数论分块> 数论分块 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/euler/ title=欧拉函数> 欧拉函数 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/sieve/ title=筛法> 筛法 </a></li><li class=md-nav__item><a title="Meissel-Lehmer 算法"class=md-nav__link href=../../math/number-theory/meissel-lehmer/> Meissel-Lehmer 算法 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/pollard-rho/ title=分解质因数> 分解质因数 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/bezouts/ title=裴蜀定理> 裴蜀定理 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/euclidean/ title=类欧几里德算法> 类欧几里德算法 </a></li><li class=md-nav__item><a title="欧拉定理 & 费马小定理"class=md-nav__link href=../../math/number-theory/fermat/> 欧拉定理 & 费马小定理 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/inverse/ title=乘法逆元> 乘法逆元 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/linear-equation/ title=线性同余方程> 线性同余方程 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/crt/ title=中国剩余定理> 中国剩余定理 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/wilson/ title=威尔逊定理> 威尔逊定理 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/lift-the-exponent/ title=升幂定理> 升幂定理 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/lucas/ title=卢卡斯定理> 卢卡斯定理 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/quad-residue/ title=二次剩余> 二次剩余 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/lagrange/ title=拉格朗日定理> 拉格朗日定理 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/primitive-root/ title=原根> 原根 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/bsgs/ title=BSGS> BSGS </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/mobius/ title=莫比乌斯反演> 莫比乌斯反演 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/du/ title=杜教筛> 杜教筛 </a></li><li class=md-nav__item><a title="Powerful Number 筛"class=md-nav__link href=../../math/number-theory/powerful-number/> Powerful Number 筛 </a></li><li class=md-nav__item><a title="Min_25 筛"class=md-nav__link href=../../math/number-theory/min-25/> Min_25 筛 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/zhou/ title=洲阁筛> 洲阁筛 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/number-theory/continued-fraction/ title=连分数> 连分数 </a></li><li class=md-nav__item><a title="Stern-Brocot 树与 Farey 序列"class=md-nav__link href=../../math/number-theory/stern-brocot/> Stern-Brocot 树与 Farey 序列 </a></li><li class=md-nav__item><a title="Pell 方程"class=md-nav__link href=../../math/number-theory/pell-equation/> Pell 方程 </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle"data-md-toggle=nav-9-10 id=nav-9-10 type=checkbox> <label class=md-nav__link for=nav-9-10>多项式</label> <nav class=md-nav data-md-component=collapsible data-md-level=2><label class=md-nav__title for=nav-9-10>多项式</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../math/poly/intro/ title=多项式部分简介> 多项式部分简介 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/poly/lagrange/ title=拉格朗日插值> 拉格朗日插值 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/poly/fft/ title=快速傅里叶变换> 快速傅里叶变换 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/poly/ntt/ title=快速数论变换> 快速数论变换 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/poly/cntt/ title=快速复数论变换> 快速复数论变换 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/poly/fwt/ title=快速沃尔什变换> 快速沃尔什变换 </a></li><li class=md-nav__item><a title="Chirp Z 变换"class=md-nav__link href=../../math/poly/czt/> Chirp Z 变换 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/poly/inv/ title=多项式求逆> 多项式求逆 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/poly/sqrt/ title=多项式开方> 多项式开方 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/poly/div-mod/ title=多项式除法|取模> 多项式除法|取模 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/poly/ln-exp/ title=多项式对数函数|指数函数> 多项式对数函数|指数函数 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/poly/newton/ title=多项式牛顿迭代> 多项式牛顿迭代 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/poly/multipoint-eval-interpolation/ title=多项式多点求值|快速插值> 多项式多点求值|快速插值 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/poly/tri-func/ title=多项式三角函数> 多项式三角函数 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/poly/inv-tri-func/ title=多项式反三角函数> 多项式反三角函数 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/linear-recurrence/ title=常系数齐次线性递推> 常系数齐次线性递推 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/poly/shift/ title=多项式平移|连续点值平移> 多项式平移|连续点值平移 </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle"data-md-toggle=nav-9-11 id=nav-9-11 type=checkbox> <label class=md-nav__link for=nav-9-11>生成函数</label> <nav class=md-nav data-md-component=collapsible data-md-level=2><label class=md-nav__title for=nav-9-11>生成函数</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../math/gen-func/intro/ title=生成函数简介> 生成函数简介 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/gen-func/symbolic-method/ title=符号化方法> 符号化方法 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/gen-func/ogf/ title=普通生成函数> 普通生成函数 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/gen-func/egf/ title=指数生成函数> 指数生成函数 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/gen-func/dgf/ title=狄利克雷生成函数> 狄利克雷生成函数 </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle"data-md-toggle=nav-9-12 id=nav-9-12 type=checkbox> <label class=md-nav__link for=nav-9-12>线性代数</label> <nav class=md-nav data-md-component=collapsible data-md-level=2><label class=md-nav__title for=nav-9-12>线性代数</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../math/vector/ title=向量> 向量 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/matrix/ title=矩阵> 矩阵 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/gauss/ title=高斯消元> 高斯消元 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/char-poly/ title=特征多项式> 特征多项式 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/basis/ title=线性基> 线性基 </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle"data-md-toggle=nav-9-13 id=nav-9-13 type=checkbox> <label class=md-nav__link for=nav-9-13>线性规划</label> <nav class=md-nav data-md-component=collapsible data-md-level=2><label class=md-nav__title for=nav-9-13>线性规划</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../math/linear-programming/ title=线性规划简介> 线性规划简介 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/simplex/ title=单纯形算法> 单纯形算法 </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle"data-md-toggle=nav-9-14 id=nav-9-14 type=checkbox> <label class=md-nav__link for=nav-9-14>组合数学</label> <nav class=md-nav data-md-component=collapsible data-md-level=2><label class=md-nav__title for=nav-9-14>组合数学</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../math/combinatorics/combination/ title=排列组合> 排列组合 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/combinatorics/catalan/ title=卡特兰数> 卡特兰数 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/combinatorics/stirling/ title=斯特林数> 斯特林数 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/combinatorics/bell/ title=贝尔数> 贝尔数 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/combinatorics/bernoulli/ title=伯努利数> 伯努利数 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/combinatorics/cantor/ title=康托展开> 康托展开 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/combinatorics/inclusion-exclusion-principle/ title=容斥原理> 容斥原理 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/combinatorics/drawer-principle/ title=抽屉原理> 抽屉原理 </a></li><li class=md-nav__item><a title="Eulerian Number"class=md-nav__link href=../../math/combinatorics/eulerian/> Eulerian Number </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/combinatorics/partition/ title=分拆数> 分拆数 </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle"data-md-toggle=nav-9-15 id=nav-9-15 type=checkbox> <label class=md-nav__link for=nav-9-15>群论</label> <nav class=md-nav data-md-component=collapsible data-md-level=2><label class=md-nav__title for=nav-9-15>群论</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../math/group-theory/ title=群论简介> 群论简介 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/permutation-group/ title=置换群> 置换群 </a></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=../../math/expectation/ title=概率初步> 概率初步 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/fibonacci/ title=斐波那契数列> 斐波那契数列 </a></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle"data-md-toggle=nav-9-18 id=nav-9-18 type=checkbox> <label class=md-nav__link for=nav-9-18>博弈论</label> <nav class=md-nav data-md-component=collapsible data-md-level=2><label class=md-nav__title for=nav-9-18>博弈论</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../math/game-theory/intro/ title=博弈论简介> 博弈论简介 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/game-theory/impartial-game/ title=公平组合游戏> 公平组合游戏 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/game-theory/partizan-game/ title=非公平组合游戏> 非公平组合游戏 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/game-theory/misere-game/ title=反常游戏> 反常游戏 </a></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=../../math/newton/ title=牛顿迭代法> 牛顿迭代法 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/integral/ title=数值积分> 数值积分 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/dictionary/ title=分段打表> 分段打表 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/fourier-motzkin-elimination/ title=傅里叶-莫茨金消元法> 傅里叶-莫茨金消元法 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/order-theory/ title=序理论> 序理论 </a></li><li class=md-nav__item><a class=md-nav__link href=../../math/young-tableau/ title=杨氏矩阵> 杨氏矩阵 </a></li><li class=md-nav__item><a title="Schreier–Sims 算法"class=md-nav__link href=../../math/schreier-sims/> Schreier–Sims 算法 </a></li><li class=md-nav__item><a title="Berlekamp-Massey 算法"class=md-nav__link href=../../math/berlekamp-massey/> Berlekamp-Massey 算法 </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle"data-md-toggle=nav-10 id=nav-10 type=checkbox> <label class=md-nav__link for=nav-10>数据结构</label> <nav class=md-nav data-md-component=collapsible data-md-level=1><label class=md-nav__title for=nav-10>数据结构</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../ds/ title=数据结构部分简介> 数据结构部分简介 </a></li><li class=md-nav__item><a class=md-nav__link href=../../ds/stack/ title=栈> 栈 </a></li><li class=md-nav__item><a class=md-nav__link href=../../ds/queue/ title=队列> 队列 </a></li><li class=md-nav__item><a class=md-nav__link href=../../ds/linked-list/ title=链表> 链表 </a></li><li class=md-nav__item><a class=md-nav__link href=../../ds/hash/ title=哈希表> 哈希表 </a></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle"data-md-toggle=nav-10-6 id=nav-10-6 type=checkbox> <label class=md-nav__link for=nav-10-6>并查集</label> <nav class=md-nav data-md-component=collapsible data-md-level=2><label class=md-nav__title for=nav-10-6>并查集</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../ds/dsu/ title=并查集> 并查集 </a></li><li class=md-nav__item><a class=md-nav__link href=../../ds/dsu-complexity/ title=并查集复杂度> 并查集复杂度 </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle"data-md-toggle=nav-10-7 id=nav-10-7 type=checkbox> <label class=md-nav__link for=nav-10-7>堆</label> <nav class=md-nav data-md-component=collapsible data-md-level=2><label class=md-nav__title for=nav-10-7>堆</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../ds/heap/ title=堆简介> 堆简介 </a></li><li class=md-nav__item><a class=md-nav__link href=../../ds/binary-heap/ title=二叉堆> 二叉堆 </a></li><li class=md-nav__item><a class=md-nav__link href=../../ds/pairing-heap/ title=配对堆> 配对堆 </a></li><li class=md-nav__item><a class=md-nav__link href=../../ds/leftist-tree/ title=左偏树> 左偏树 </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle"data-md-toggle=nav-10-8 id=nav-10-8 type=checkbox> <label class=md-nav__link for=nav-10-8>块状数据结构</label> <nav class=md-nav data-md-component=collapsible data-md-level=2><label class=md-nav__title for=nav-10-8>块状数据结构</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../ds/decompose/ title=分块思想> 分块思想 </a></li><li class=md-nav__item><a class=md-nav__link href=../../ds/block-array/ title=块状数组> 块状数组 </a></li><li class=md-nav__item><a class=md-nav__link href=../../ds/block-list/ title=块状链表> 块状链表 </a></li><li class=md-nav__item><a class=md-nav__link href=../../ds/tree-decompose/ title=树分块> 树分块 </a></li><li class=md-nav__item><a title="Sqrt Tree"class=md-nav__link href=../../ds/sqrt-tree/> Sqrt Tree </a></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=../../ds/monotonous-stack/ title=单调栈> 单调栈 </a></li><li class=md-nav__item><a class=md-nav__link href=../../ds/monotonous-queue/ title=单调队列> 单调队列 </a></li><li class=md-nav__item><a title="ST 表"class=md-nav__link href=../../ds/sparse-table/> ST 表 </a></li><li class=md-nav__item><a class=md-nav__link href=../../ds/fenwick/ title=树状数组> 树状数组 </a></li><li class=md-nav__item><a class=md-nav__link href=../../ds/seg/ title=线段树> 线段树 </a></li><li class=md-nav__item><a class=md-nav__link href=../../ds/li-chao-tree/ title=李超线段树> 李超线段树 </a></li><li class=md-nav__item><a title="区间最值操作 & 区间历史最值"class=md-nav__link href=../../ds/seg-beats/> 区间最值操作 & 区间历史最值 </a></li><li class=md-nav__item><a class=md-nav__link href=../../ds/dividing/ title=划分树> 划分树 </a></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle"data-md-toggle=nav-10-17 id=nav-10-17 type=checkbox> <label class=md-nav__link for=nav-10-17>二叉搜索树 & 平衡树</label> <nav class=md-nav data-md-component=collapsible data-md-level=2><label class=md-nav__title for=nav-10-17>二叉搜索树 & 平衡树</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../ds/bst/ title=二叉搜索树简介> 二叉搜索树简介 </a></li><li class=md-nav__item><a class=md-nav__link href=../../ds/treap/ title=Treap> Treap </a></li><li class=md-nav__item><a class=md-nav__link href=../../ds/splay/ title=Splay> Splay </a></li><li class=md-nav__item><a class=md-nav__link href=../../ds/wblt/ title=WBLT> WBLT </a></li><li class=md-nav__item><a title="Size Balanced Tree"class=md-nav__link href=../../ds/sbt/> Size Balanced Tree </a></li><li class=md-nav__item><a title="AVL 树"class=md-nav__link href=../../ds/avl/> AVL 树 </a></li><li class=md-nav__item><a class=md-nav__link href=../../ds/sgt/ title=替罪羊树> 替罪羊树 </a></li><li class=md-nav__item><a class=md-nav__link href=../../ds/cartesian-tree/ title=笛卡尔树> 笛卡尔树 </a></li><li class=md-nav__item><a class=md-nav__link href=../../ds/llrbt/ title=左偏红黑树> 左偏红黑树 </a></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=../../ds/skiplist/ title=跳表> 跳表 </a></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle"data-md-toggle=nav-10-19 id=nav-10-19 type=checkbox> <label class=md-nav__link for=nav-10-19>可持久化数据结构</label> <nav class=md-nav data-md-component=collapsible data-md-level=2><label class=md-nav__title for=nav-10-19>可持久化数据结构</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../ds/persistent/ title=可持久化数据结构简介> 可持久化数据结构简介 </a></li><li class=md-nav__item><a class=md-nav__link href=../../ds/persistent-seg/ title=可持久化线段树> 可持久化线段树 </a></li><li class=md-nav__item><a class=md-nav__link href=../../ds/persistent-block-array/ title=可持久化块状数组> 可持久化块状数组 </a></li><li class=md-nav__item><a class=md-nav__link href=../../ds/persistent-balanced/ title=可持久化平衡树> 可持久化平衡树 </a></li><li class=md-nav__item><a class=md-nav__link href=../../ds/persistent-trie/ title=可持久化字典树> 可持久化字典树 </a></li><li class=md-nav__item><a class=md-nav__link href=../../ds/persistent-heap/ title=可持久化可并堆> 可持久化可并堆 </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle"data-md-toggle=nav-10-20 id=nav-10-20 type=checkbox> <label class=md-nav__link for=nav-10-20>树套树</label> <nav class=md-nav data-md-component=collapsible data-md-level=2><label class=md-nav__title for=nav-10-20>树套树</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../ds/seg-in-seg/ title=线段树套线段树> 线段树套线段树 </a></li><li class=md-nav__item><a class=md-nav__link href=../../ds/seg-in-balanced/ title=平衡树套线段树> 平衡树套线段树 </a></li><li class=md-nav__item><a class=md-nav__link href=../../ds/balanced-in-seg/ title=线段树套平衡树> 线段树套平衡树 </a></li><li class=md-nav__item><a class=md-nav__link href=../../ds/persistent-in-bit/ title=树状数组套主席树> 树状数组套主席树 </a></li><li class=md-nav__item><a class=md-nav__link href=../../ds/bit-in-block-array/ title=分块套树状数组> 分块套树状数组 </a></li></ul></nav></li><li class=md-nav__item><a title="K-D Tree"class=md-nav__link href=../../ds/kdt/> K-D Tree </a></li><li class=md-nav__item><a class=md-nav__link href=../../ds/odt/ title=珂朵莉树> 珂朵莉树 </a></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle"data-md-toggle=nav-10-23 id=nav-10-23 type=checkbox> <label class=md-nav__link for=nav-10-23>动态树</label> <nav class=md-nav data-md-component=collapsible data-md-level=2><label class=md-nav__title for=nav-10-23>动态树</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a title="Link Cut Tree"class=md-nav__link href=../../ds/lct/> Link Cut Tree </a></li><li class=md-nav__item><a title="Euler Tour Tree"class=md-nav__link href=../../ds/ett/> Euler Tour Tree </a></li><li class=md-nav__item><a title="Top Tree"class=md-nav__link href=../../ds/top-tree/> Top Tree </a></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=../../ds/divide-combine/ title=析合树> 析合树 </a></li><li class=md-nav__item><a title="PQ 树"class=md-nav__link href=../../ds/pq-tree/> PQ 树 </a></li><li class=md-nav__item><a class=md-nav__link href=../../ds/finger-tree/ title=手指树> 手指树 </a></li><li class=md-nav__item><a class=md-nav__link href=../../ds/huffman-tree/ title=霍夫曼树> 霍夫曼树 </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle"data-md-toggle=nav-11 id=nav-11 type=checkbox> <label class=md-nav__link for=nav-11>图论</label> <nav class=md-nav data-md-component=collapsible data-md-level=1><label class=md-nav__title for=nav-11>图论</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../graph/ title=图论部分简介> 图论部分简介 </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/concept/ title=图论相关概念> 图论相关概念 </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/save/ title=图的存储> 图的存储 </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/dfs/ title=DFS（图论）> DFS（图论） </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/bfs/ title=BFS（图论）> BFS（图论） </a></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle"data-md-toggle=nav-11-6 id=nav-11-6 type=checkbox> <label class=md-nav__link for=nav-11-6>树上问题</label> <nav class=md-nav data-md-component=collapsible data-md-level=2><label class=md-nav__title for=nav-11-6>树上问题</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../graph/tree-basic/ title=树基础> 树基础 </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/tree-diameter/ title=树的直径> 树的直径 </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/lca/ title=最近公共祖先> 最近公共祖先 </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/tree-centroid/ title=树的重心> 树的重心 </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/hld/ title=树链剖分> 树链剖分 </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/dsu-on-tree/ title=树上启发式合并> 树上启发式合并 </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/virtual-tree/ title=虚树> 虚树 </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/tree-divide/ title=树分治> 树分治 </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/dynamic-tree-divide/ title=动态树分治> 动态树分治 </a></li><li class=md-nav__item><a title="AHU 算法"class=md-nav__link href=../../graph/tree-ahu/> AHU 算法 </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/tree-hash/ title=树哈希> 树哈希 </a></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=../../graph/matrix-tree/ title=矩阵树定理> 矩阵树定理 </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/dag/ title=有向无环图> 有向无环图 </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/topo/ title=拓扑排序> 拓扑排序 </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/mst/ title=最小生成树> 最小生成树 </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/steiner-tree/ title=斯坦纳树> 斯坦纳树 </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/dmst/ title=最小树形图> 最小树形图 </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/mdst/ title=最小直径生成树> 最小直径生成树 </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/shortest-path/ title=最短路> 最短路 </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/node/ title=拆点> 拆点 </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/diff-constraints/ title=差分约束> 差分约束 </a></li><li class=md-nav__item><a title="k 短路"class=md-nav__link href=../../graph/kth-path/> k 短路 </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/mod-shortest-path/ title=同余最短路> 同余最短路 </a></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle"data-md-toggle=nav-11-19 id=nav-11-19 type=checkbox> <label class=md-nav__link for=nav-11-19>连通性相关</label> <nav class=md-nav data-md-component=collapsible data-md-level=2><label class=md-nav__title for=nav-11-19>连通性相关</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../graph/scc/ title=强连通分量> 强连通分量 </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/bcc/ title=双连通分量> 双连通分量 </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/cut/ title=割点和桥> 割点和桥 </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/block-forest/ title=圆方树> 圆方树 </a></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=../../graph/2-sat/ title=2-SAT> 2-SAT </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/euler/ title=欧拉图> 欧拉图 </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/hamilton/ title=哈密顿图> 哈密顿图 </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/bi-graph/ title=二分图> 二分图 </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/min-circle/ title=最小环> 最小环 </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/planar/ title=平面图> 平面图 </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/color/ title=图的着色> 图的着色 </a></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle"data-md-toggle=nav-11-27 id=nav-11-27 type=checkbox> <label class=md-nav__link for=nav-11-27>网络流</label> <nav class=md-nav data-md-component=collapsible data-md-level=2><label class=md-nav__title for=nav-11-27>网络流</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../graph/flow/ title=网络流简介> 网络流简介 </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/flow/max-flow/ title=最大流> 最大流 </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/flow/min-cut/ title=最小割> 最小割 </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/flow/min-cost/ title=费用流> 费用流 </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/flow/bound/ title=上下界网络流> 上下界网络流 </a></li></ul></nav></li><li class=md-nav__item><a title="Stoer-Wagner 算法"class=md-nav__link href=../../graph/stoer-wagner/> Stoer-Wagner 算法 </a></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle"data-md-toggle=nav-11-29 id=nav-11-29 type=checkbox> <label class=md-nav__link for=nav-11-29>图的匹配</label> <nav class=md-nav data-md-component=collapsible data-md-level=2><label class=md-nav__title for=nav-11-29>图的匹配</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../graph/graph-matching/graph-match/ title=图匹配> 图匹配 </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/graph-matching/augment/ title=增广路> 增广路 </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/graph-matching/bigraph-match/ title=二分图最大匹配> 二分图最大匹配 </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/graph-matching/bigraph-weight-match/ title=二分图最大权匹配> 二分图最大权匹配 </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/graph-matching/general-match/ title=一般图最大匹配> 一般图最大匹配 </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/graph-matching/general-weight-match/ title=一般图最大权匹配> 一般图最大权匹配 </a></li></ul></nav></li><li class=md-nav__item><a title="Prufer 序列"class=md-nav__link href=../../graph/prufer/> Prufer 序列 </a></li><li class=md-nav__item><a title="LGV 引理"class=md-nav__link href=../../graph/lgv/> LGV 引理 </a></li><li class=md-nav__item><a class=md-nav__link href=../../graph/chord/ title=弦图> 弦图 </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle"data-md-toggle=nav-12 id=nav-12 type=checkbox> <label class=md-nav__link for=nav-12>计算几何</label> <nav class=md-nav data-md-component=collapsible data-md-level=1><label class=md-nav__title for=nav-12>计算几何</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../geometry/ title=计算几何部分简介> 计算几何部分简介 </a></li><li class=md-nav__item><a class=md-nav__link href=../../geometry/2d/ title=二维计算几何基础> 二维计算几何基础 </a></li><li class=md-nav__item><a class=md-nav__link href=../../geometry/3d/ title=三维计算几何基础> 三维计算几何基础 </a></li><li class=md-nav__item><a class=md-nav__link href=../../geometry/polar-coordinate/ title=极坐标系> 极坐标系 </a></li><li class=md-nav__item><a class=md-nav__link href=../../geometry/distance/ title=距离> 距离 </a></li><li class=md-nav__item><a title="Pick 定理"class=md-nav__link href=../../geometry/pick/> Pick 定理 </a></li><li class=md-nav__item><a class=md-nav__link href=../../geometry/triangulation/ title=三角剖分> 三角剖分 </a></li><li class=md-nav__item><a class=md-nav__link href=../../geometry/convex-hull/ title=凸包> 凸包 </a></li><li class=md-nav__item><a class=md-nav__link href=../../geometry/scanning/ title=扫描线> 扫描线 </a></li><li class=md-nav__item><a class=md-nav__link href=../../geometry/rotating-calipers/ title=旋转卡壳> 旋转卡壳 </a></li><li class=md-nav__item><a class=md-nav__link href=../../geometry/half-plane/ title=半平面交> 半平面交 </a></li><li class=md-nav__item><a class=md-nav__link href=../../geometry/nearest-points/ title=平面最近点对> 平面最近点对 </a></li><li class=md-nav__item><a class=md-nav__link href=../../geometry/random-incremental/ title=随机增量法> 随机增量法 </a></li><li class=md-nav__item><a class=md-nav__link href=../../geometry/inverse/ title=反演变换> 反演变换 </a></li><li class=md-nav__item><a class=md-nav__link href=../../geometry/misc/ title=计算几何杂项> 计算几何杂项 </a></li></ul></nav></li><li class="md-nav__item md-nav__item--active md-nav__item--nested"><input class="md-toggle md-nav__toggle"checked data-md-toggle=nav-13 id=nav-13 type=checkbox> <label class=md-nav__link for=nav-13>杂项</label> <nav class=md-nav data-md-component=collapsible data-md-level=1><label class=md-nav__title for=nav-13>杂项</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../ title=杂项简介> 杂项简介 </a></li><li class=md-nav__item><a class=md-nav__link href=../discrete/ title=离散化> 离散化 </a></li><li class=md-nav__item><a class=md-nav__link href=../two-pointer/ title=双指针> 双指针 </a></li><li class="md-nav__item md-nav__item--active md-nav__item--nested"><input class="md-toggle md-nav__toggle"checked data-md-toggle=nav-13-4 id=nav-13-4 type=checkbox> <label class=md-nav__link for=nav-13-4>离线算法</label> <nav class=md-nav data-md-component=collapsible data-md-level=2><label class=md-nav__title for=nav-13-4>离线算法</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../offline/ title=离线算法简介> 离线算法简介 </a></li><li class=md-nav__item><a title="CDQ 分治"class=md-nav__link href=../cdq-divide/> CDQ 分治 </a></li><li class=md-nav__item><a class=md-nav__link href=../parallel-binsearch/ title=整体二分> 整体二分 </a></li><li class="md-nav__item md-nav__item--active md-nav__item--nested"><input class="md-toggle md-nav__toggle"checked data-md-toggle=nav-13-4-4 id=nav-13-4-4 type=checkbox> <label class=md-nav__link for=nav-13-4-4>莫队算法</label> <nav class=md-nav data-md-component=collapsible data-md-level=3><label class=md-nav__title for=nav-13-4-4>莫队算法</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../mo-algo-intro/ title=莫队算法简介> 莫队算法简介 </a></li><li class=md-nav__item><a class=md-nav__link href=../mo-algo/ title=普通莫队算法> 普通莫队算法 </a></li><li class=md-nav__item><a class=md-nav__link href=../modifiable-mo-algo/ title=带修改莫队> 带修改莫队 </a></li><li class="md-nav__item md-nav__item--active"><input class="md-toggle md-nav__toggle"data-md-toggle=toc id=__toc type=checkbox> <label class="md-nav__link md-nav__link--active"for=__toc>树上莫队</label> <a class="md-nav__link md-nav__link--active"href=./ title=树上莫队> 树上莫队 </a> <nav class="md-nav md-nav--secondary"><label class=md-nav__title for=__toc>目录</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=#_1> 括号序树上莫队 </a></li><li class=md-nav__item><a class=md-nav__link href=#_2> 真·树上莫队 </a> <nav class=md-nav><ul class=md-nav__list><li class=md-nav__item><a class=md-nav__link href=#_3> 询问的排序 </a></li><li class=md-nav__item><a class=md-nav__link href=#_4> 指针的移动 </a></li><li class=md-nav__item><a class=md-nav__link href=#_5> 时间复杂度 </a></li><li class=md-nav__item><a class=md-nav__link href=#wc2013> 例题「WC2013」糖果公园 </a></li></ul></nav></li><li class=md-nav__item><a class="md-nav__link md-nav__link--active"href=#__comments title=评论> 评论 </a></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=../rollback-mo-algo/ title=回滚莫队> 回滚莫队 </a></li><li class=md-nav__item><a title="莫队配合 bitset"class=md-nav__link href=../mo-algo-with-bitset/> 莫队配合 bitset </a></li></ul></nav></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=../frac-programming/ title=分数规划> 分数规划 </a></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle"data-md-toggle=nav-13-6 id=nav-13-6 type=checkbox> <label class=md-nav__link for=nav-13-6>随机化</label> <nav class=md-nav data-md-component=collapsible data-md-level=2><label class=md-nav__title for=nav-13-6>随机化</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../random/ title=随机函数> 随机函数 </a></li><li class=md-nav__item><a class=md-nav__link href=../rand-technique/ title=随机化技巧> 随机化技巧 </a></li><li class=md-nav__item><a class=md-nav__link href=../hill-climbing/ title=爬山算法> 爬山算法 </a></li><li class=md-nav__item><a class=md-nav__link href=../simulated-annealing/ title=模拟退火> 模拟退火 </a></li></ul></nav></li><li class=md-nav__item><a class=md-nav__link href=../hoverline/ title=悬线法> 悬线法 </a></li><li class=md-nav__item><a class=md-nav__link href=../cc-basic/ title=计算理论基础> 计算理论基础 </a></li><li class=md-nav__item><a class=md-nav__link href=../endianness/ title=字节顺序> 字节顺序 </a></li><li class=md-nav__item><a class=md-nav__link href=../josephus/ title=约瑟夫问题> 约瑟夫问题 </a></li><li class=md-nav__item><a class=md-nav__link href=../gray-code/ title=格雷码> 格雷码 </a></li><li class=md-nav__item><a class=md-nav__link href=../expression/ title=表达式求值> 表达式求值 </a></li><li class=md-nav__item><a class=md-nav__link href=../job-order/ title=在一台机器上规划任务> 在一台机器上规划任务 </a></li><li class=md-nav__item><a class=md-nav__link href=../main-element/ title=主元素问题> 主元素问题 </a></li><li class=md-nav__item><a title="Garsia-Wachs 算法"class=md-nav__link href=../garsia-wachs/> Garsia-Wachs 算法 </a></li><li class=md-nav__item><a class=md-nav__link href=../15-puzzle/ title=15-puzzle> 15-puzzle </a></li><li class=md-nav__item><a title="Kahan 求和"class=md-nav__link href=../kahan-summation/> Kahan 求和 </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle"data-md-toggle=nav-14 id=nav-14 type=checkbox> <label class=md-nav__link for=nav-14>专题</label> <nav class=md-nav data-md-component=collapsible data-md-level=1><label class=md-nav__title for=nav-14>专题</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=../../topic/rmq/ title=RMQ> RMQ </a></li><li class=md-nav__item><a class=md-nav__link href=../../topic/dsu-app/ title=并查集应用> 并查集应用 </a></li><li class=md-nav__item><a class=md-nav__link href=../../topic/bracket/ title=括号序列> 括号序列 </a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle"data-md-toggle=nav-15 id=nav-15 type=checkbox> <label class=md-nav__link for=nav-15>关于 Hulu</label> <nav class=md-nav data-md-component=collapsible data-md-level=1><label class=md-nav__title for=nav-15>关于 Hulu</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a title="关于 Hulu"class=md-nav__link href=../../intro/hulu/> 关于 Hulu </a></li></ul></nav></li></ul></nav></div></div></div><div class="md-sidebar md-sidebar--secondary"data-md-component=toc><div class=md-sidebar__scrollwrap><div class=md-sidebar__inner><nav class="md-nav md-nav--secondary"><label class=md-nav__title for=__toc>目录</label><ul class=md-nav__list data-md-scrollfix><li class=md-nav__item><a class=md-nav__link href=#_1> 括号序树上莫队 </a></li><li class=md-nav__item><a class=md-nav__link href=#_2> 真·树上莫队 </a> <nav class=md-nav><ul class=md-nav__list><li class=md-nav__item><a class=md-nav__link href=#_3> 询问的排序 </a></li><li class=md-nav__item><a class=md-nav__link href=#_4> 指针的移动 </a></li><li class=md-nav__item><a class=md-nav__link href=#_5> 时间复杂度 </a></li><li class=md-nav__item><a class=md-nav__link href=#wc2013> 例题「WC2013」糖果公园 </a></li></ul></nav></li><li class=md-nav__item><a class="md-nav__link md-nav__link--active"href=#__comments title=评论> 评论 </a></li></ul></nav></div></div></div><div class=md-content><article class="md-content__inner md-typeset"><a class="md-icon md-content__icon"href=https://oi-wiki.org/edit-landing/?ref=/misc/mo-algo-on-tree.md title=编辑此页></a><h1>树上莫队</h1><h2 id=_1>括号序树上莫队<a title="Permanent link"class=headerlink href=#_1>¶</a></h2><p>一般的莫队只能处理线性问题，我们要把树强行压成序列。</p><p>我们可以将树的括号序跑下来，把括号序分块，在括号序上跑莫队。</p><p>具体怎么做呢？</p><p>dfs 一棵树，然后如果 dfs 到 x 点，就 <code>push_back(x)</code>，dfs 完 x 点，就直接 <code>push_back(-x)</code>，然后我们在挪动指针的时候，</p><ul><li>新加入的值是 x ---><code>add(x)</code></li><li>新加入的值是 - x ---><code>del(x)</code></li><li>新删除的值是 x ---><code>del(x)</code></li><li>新删除的值是 - x ---><code>add(x)</code></li></ul><p>这样的话，我们就把一棵树处理成了序列。</p><details class=note open><summary>例题<a href=https://uoj.ac/problem/58>「WC2013」糖果公园</a></summary> <p>题意：给你一棵树，树上第 <span class=arithmatex><span class=mjpage><svg viewbox="0 -755.5 345.5 865.1"aria-labelledby=MathJax-SVG-1-Title focusable=false height=2.009ex role=img style=vertical-align:-0.255ex width=0.802ex xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title id=MathJax-SVG-1-Title>i</title><defs aria-hidden=true><path d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"id=E1-MJMATHI-69 stroke-width=1></path></defs><g transform="matrix(1 0 0 -1 0 0)"aria-hidden=true fill=currentColor stroke=currentColor stroke-width=0><use x=0 xlink:href=#E1-MJMATHI-69 y=0></use></g></svg></span></span> 个点颜色为 <span class=arithmatex><span class=mjpage><svg viewbox="0 -540.2 777.8 757.5"aria-labelledby=MathJax-SVG-2-Title focusable=false height=1.759ex role=img style=vertical-align:-0.505ex width=1.807ex xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title id=MathJax-SVG-2-Title>c_i</title><defs aria-hidden=true><path d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"id=E2-MJMATHI-63 stroke-width=1></path><path d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"id=E2-MJMATHI-69 stroke-width=1></path></defs><g transform="matrix(1 0 0 -1 0 0)"aria-hidden=true fill=currentColor stroke=currentColor stroke-width=0><use x=0 xlink:href=#E2-MJMATHI-63 y=0></use><use transform=scale(0.707) x=613 xlink:href=#E2-MJMATHI-69 y=-213></use></g></svg></span></span>，每次询问一条路径 <span class=arithmatex><span class=mjpage><svg viewbox="0 -540.2 916.8 757.5"aria-labelledby=MathJax-SVG-3-Title focusable=false height=1.759ex role=img style=vertical-align:-0.505ex width=2.129ex xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title id=MathJax-SVG-3-Title>u_i</title><defs aria-hidden=true><path d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"id=E3-MJMATHI-75 stroke-width=1></path><path d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"id=E3-MJMATHI-69 stroke-width=1></path></defs><g transform="matrix(1 0 0 -1 0 0)"aria-hidden=true fill=currentColor stroke=currentColor stroke-width=0><use x=0 xlink:href=#E3-MJMATHI-75 y=0></use><use transform=scale(0.707) x=809 xlink:href=#E3-MJMATHI-69 y=-213></use></g></svg></span></span>,<span class=arithmatex><span class=mjpage><svg viewbox="0 -540.2 829.8 757.5"aria-labelledby=MathJax-SVG-4-Title focusable=false height=1.759ex role=img style=vertical-align:-0.505ex width=1.927ex xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title id=MathJax-SVG-4-Title>v_i</title><defs aria-hidden=true><path d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"id=E4-MJMATHI-76 stroke-width=1></path><path d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"id=E4-MJMATHI-69 stroke-width=1></path></defs><g transform="matrix(1 0 0 -1 0 0)"aria-hidden=true fill=currentColor stroke=currentColor stroke-width=0><use x=0 xlink:href=#E4-MJMATHI-76 y=0></use><use transform=scale(0.707) x=686 xlink:href=#E4-MJMATHI-69 y=-213></use></g></svg></span></span>, 求这条路径上的</p> <p><span class=arithmatex><span class=mjpage><svg viewbox="0 -1024.6 7174.6 1403.3"aria-labelledby=MathJax-SVG-5-Title focusable=false height=3.259ex role=img style=vertical-align:-0.88ex width=16.664ex xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title id=MathJax-SVG-5-Title>\sum_{c}val_c\sum_{i=1}^{cnt_c}w_i</title><defs aria-hidden=true><path d="M61 748Q64 750 489 750H913L954 640Q965 609 976 579T993 533T999 516H979L959 517Q936 579 886 621T777 682Q724 700 655 705T436 710H319Q183 710 183 709Q186 706 348 484T511 259Q517 250 513 244L490 216Q466 188 420 134T330 27L149 -187Q149 -188 362 -188Q388 -188 436 -188T506 -189Q679 -189 778 -162T936 -43Q946 -27 959 6H999L913 -249L489 -250Q65 -250 62 -248Q56 -246 56 -239Q56 -234 118 -161Q186 -81 245 -11L428 206Q428 207 242 462L57 717L56 728Q56 744 61 748Z"id=E5-MJSZ1-2211 stroke-width=1></path><path d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"id=E5-MJMATHI-63 stroke-width=1></path><path d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"id=E5-MJMATHI-76 stroke-width=1></path><path d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"id=E5-MJMATHI-61 stroke-width=1></path><path d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"id=E5-MJMATHI-6C stroke-width=1></path><path d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"id=E5-MJMATHI-6E stroke-width=1></path><path d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"id=E5-MJMATHI-74 stroke-width=1></path><path d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"id=E5-MJMATHI-69 stroke-width=1></path><path d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"id=E5-MJMAIN-3D stroke-width=1></path><path d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"id=E5-MJMAIN-31 stroke-width=1></path><path d="M580 385Q580 406 599 424T641 443Q659 443 674 425T690 368Q690 339 671 253Q656 197 644 161T609 80T554 12T482 -11Q438 -11 404 5T355 48Q354 47 352 44Q311 -11 252 -11Q226 -11 202 -5T155 14T118 53T104 116Q104 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Q21 293 29 315T52 366T96 418T161 441Q204 441 227 416T250 358Q250 340 217 250T184 111Q184 65 205 46T258 26Q301 26 334 87L339 96V119Q339 122 339 128T340 136T341 143T342 152T345 165T348 182T354 206T362 238T373 281Q402 395 406 404Q419 431 449 431Q468 431 475 421T483 402Q483 389 454 274T422 142Q420 131 420 107V100Q420 85 423 71T442 42T487 26Q558 26 600 148Q609 171 620 213T632 273Q632 306 619 325T593 357T580 385Z"id=E5-MJMATHI-77 stroke-width=1></path></defs><g transform="matrix(1 0 0 -1 0 0)"aria-hidden=true fill=currentColor stroke=currentColor stroke-width=0><use x=0 xlink:href=#E5-MJSZ1-2211 y=0></use><use transform=scale(0.707) x=1494 xlink:href=#E5-MJMATHI-63 y=-405></use><use x=1629 xlink:href=#E5-MJMATHI-76 y=0></use><use x=2115 xlink:href=#E5-MJMATHI-61 y=0></use><g transform=translate(2644,0)><use x=0 xlink:href=#E5-MJMATHI-6C y=0></use><use transform=scale(0.707) x=422 xlink:href=#E5-MJMATHI-63 y=-213></use></g><g transform=translate(3516,0)><use x=0 xlink:href=#E5-MJSZ1-2211 y=0></use><g transform=translate(1056,477)><use transform=scale(0.707) x=0 xlink:href=#E5-MJMATHI-63 y=0></use><use transform=scale(0.707) x=433 xlink:href=#E5-MJMATHI-6E y=0></use><g transform=translate(731,0)><use transform=scale(0.707) x=0 xlink:href=#E5-MJMATHI-74 y=0></use><use transform=scale(0.5) x=511 xlink:href=#E5-MJMATHI-63 y=-213></use></g></g><g transform=translate(1056,-287)><use transform=scale(0.707) x=0 xlink:href=#E5-MJMATHI-69 y=0></use><use transform=scale(0.707) x=345 xlink:href=#E5-MJMAIN-3D y=0></use><use transform=scale(0.707) x=1124 xlink:href=#E5-MJMAIN-31 y=0></use></g></g><g transform=translate(6113,0)><use x=0 xlink:href=#E5-MJMATHI-77 y=0></use><use transform=scale(0.707) x=1013 xlink:href=#E5-MJMATHI-69 y=-213></use></g></g></svg></span></span></p> <p>其中：<span class=arithmatex><span class=mjpage><svg viewbox="0 -755.5 1313.5 865.1"aria-labelledby=MathJax-SVG-6-Title focusable=false height=2.009ex role=img style=vertical-align:-0.255ex width=3.051ex xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title id=MathJax-SVG-6-Title>val</title><defs aria-hidden=true><path d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"id=E6-MJMATHI-76 stroke-width=1></path><path d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"id=E6-MJMATHI-61 stroke-width=1></path><path d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"id=E6-MJMATHI-6C stroke-width=1></path></defs><g transform="matrix(1 0 0 -1 0 0)"aria-hidden=true fill=currentColor stroke=currentColor stroke-width=0><use x=0 xlink:href=#E6-MJMATHI-76 y=0></use><use x=485 xlink:href=#E6-MJMATHI-61 y=0></use><use x=1015 xlink:href=#E6-MJMATHI-6C y=0></use></g></svg></span></span> 表示该颜色的价值，<span class=arithmatex><span class=mjpage><svg viewbox="0 -701.7 1395.5 811.3"aria-labelledby=MathJax-SVG-7-Title focusable=false height=1.884ex role=img style=vertical-align:-0.255ex width=3.241ex xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title id=MathJax-SVG-7-Title>cnt</title><defs aria-hidden=true><path d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"id=E7-MJMATHI-63 stroke-width=1></path><path d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"id=E7-MJMATHI-6E stroke-width=1></path><path d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"id=E7-MJMATHI-74 stroke-width=1></path></defs><g transform="matrix(1 0 0 -1 0 0)"aria-hidden=true fill=currentColor stroke=currentColor stroke-width=0><use x=0 xlink:href=#E7-MJMATHI-63 y=0></use><use x=433 xlink:href=#E7-MJMATHI-6E y=0></use><use x=1034 xlink:href=#E7-MJMATHI-74 y=0></use></g></svg></span></span> 表示颜色出现的次数，<span class=arithmatex><span class=mjpage><svg viewbox="0 -540.2 716.5 649.8"aria-labelledby=MathJax-SVG-8-Title focusable=false height=1.509ex role=img style=vertical-align:-0.255ex width=1.664ex xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title id=MathJax-SVG-8-Title>w</title><defs aria-hidden=true><path d="M580 385Q580 406 599 424T641 443Q659 443 674 425T690 368Q690 339 671 253Q656 197 644 161T609 80T554 12T482 -11Q438 -11 404 5T355 48Q354 47 352 44Q311 -11 252 -11Q226 -11 202 -5T155 14T118 53T104 116Q104 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Q21 293 29 315T52 366T96 418T161 441Q204 441 227 416T250 358Q250 340 217 250T184 111Q184 65 205 46T258 26Q301 26 334 87L339 96V119Q339 122 339 128T340 136T341 143T342 152T345 165T348 182T354 206T362 238T373 281Q402 395 406 404Q419 431 449 431Q468 431 475 421T483 402Q483 389 454 274T422 142Q420 131 420 107V100Q420 85 423 71T442 42T487 26Q558 26 600 148Q609 171 620 213T632 273Q632 306 619 325T593 357T580 385Z"id=E8-MJMATHI-77 stroke-width=1></path></defs><g transform="matrix(1 0 0 -1 0 0)"aria-hidden=true fill=currentColor stroke=currentColor stroke-width=0><use x=0 xlink:href=#E8-MJMATHI-77 y=0></use></g></svg></span></span> 表示该颜色出现 <span class=arithmatex><span class=mjpage><svg viewbox="0 -755.5 345.5 865.1"aria-labelledby=MathJax-SVG-9-Title focusable=false height=2.009ex role=img style=vertical-align:-0.255ex width=0.802ex xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title id=MathJax-SVG-9-Title>i</title><defs aria-hidden=true><path d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"id=E9-MJMATHI-69 stroke-width=1></path></defs><g transform="matrix(1 0 0 -1 0 0)"aria-hidden=true fill=currentColor stroke=currentColor stroke-width=0><use x=0 xlink:href=#E9-MJMATHI-69 y=0></use></g></svg></span></span> 次后的价值</p></details><p>先把树变成序列，然后每次添加/删除一个点，这个点的对答案的的贡献是可以在 <span class=arithmatex><span class=mjpage><svg viewbox="0 -809.3 2043 1134.2"aria-labelledby=MathJax-SVG-10-Title focusable=false height=2.634ex role=img style=vertical-align:-0.755ex width=4.745ex xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title id=MathJax-SVG-10-Title>O(1)</title><defs aria-hidden=true><path d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"id=E10-MJMATHI-4F stroke-width=1></path><path d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"id=E10-MJMAIN-28 stroke-width=1></path><path d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"id=E10-MJMAIN-31 stroke-width=1></path><path d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"id=E10-MJMAIN-29 stroke-width=1></path></defs><g transform="matrix(1 0 0 -1 0 0)"aria-hidden=true fill=currentColor stroke=currentColor stroke-width=0><use x=0 xlink:href=#E10-MJMATHI-4F y=0></use><use x=763 xlink:href=#E10-MJMAIN-28 y=0></use><use x=1153 xlink:href=#E10-MJMAIN-31 y=0></use><use x=1653 xlink:href=#E10-MJMAIN-29 y=0></use></g></svg></span></span> 时间内获得的，即 <span class=arithmatex><span class=mjpage><svg viewbox="0 -755.5 5673.2 1134.2"aria-labelledby=MathJax-SVG-11-Title focusable=false height=2.634ex role=img style=vertical-align:-0.88ex width=13.177ex xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title id=MathJax-SVG-11-Title>val_c\times w_{cnt_{c+1}}</title><defs aria-hidden=true><path d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"id=E11-MJMATHI-76 stroke-width=1></path><path d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"id=E11-MJMATHI-61 stroke-width=1></path><path d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"id=E11-MJMATHI-6C stroke-width=1></path><path d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"id=E11-MJMATHI-63 stroke-width=1></path><path d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z"id=E11-MJMAIN-D7 stroke-width=1></path><path d="M580 385Q580 406 599 424T641 443Q659 443 674 425T690 368Q690 339 671 253Q656 197 644 161T609 80T554 12T482 -11Q438 -11 404 5T355 48Q354 47 352 44Q311 -11 252 -11Q226 -11 202 -5T155 14T118 53T104 116Q104 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Q21 293 29 315T52 366T96 418T161 441Q204 441 227 416T250 358Q250 340 217 250T184 111Q184 65 205 46T258 26Q301 26 334 87L339 96V119Q339 122 339 128T340 136T341 143T342 152T345 165T348 182T354 206T362 238T373 281Q402 395 406 404Q419 431 449 431Q468 431 475 421T483 402Q483 389 454 274T422 142Q420 131 420 107V100Q420 85 423 71T442 42T487 26Q558 26 600 148Q609 171 620 213T632 273Q632 306 619 325T593 357T580 385Z"id=E11-MJMATHI-77 stroke-width=1></path><path d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"id=E11-MJMATHI-6E stroke-width=1></path><path d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"id=E11-MJMATHI-74 stroke-width=1></path><path d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"id=E11-MJMAIN-2B stroke-width=1></path><path d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"id=E11-MJMAIN-31 stroke-width=1></path></defs><g transform="matrix(1 0 0 -1 0 0)"aria-hidden=true fill=currentColor stroke=currentColor stroke-width=0><use x=0 xlink:href=#E11-MJMATHI-76 y=0></use><use x=485 xlink:href=#E11-MJMATHI-61 y=0></use><g transform=translate(1015,0)><use x=0 xlink:href=#E11-MJMATHI-6C y=0></use><use transform=scale(0.707) x=422 xlink:href=#E11-MJMATHI-63 y=-213></use></g><use x=1942 xlink:href=#E11-MJMAIN-D7 y=0></use><g transform=translate(2942,0)><use x=0 xlink:href=#E11-MJMATHI-77 y=0></use><g transform=translate(716,-150)><use transform=scale(0.707) x=0 xlink:href=#E11-MJMATHI-63 y=0></use><use transform=scale(0.707) x=433 xlink:href=#E11-MJMATHI-6E y=0></use><g transform=translate(731,0)><use transform=scale(0.707) x=0 xlink:href=#E11-MJMATHI-74 y=0></use><g transform=translate(255,-107)><use transform=scale(0.5) x=0 xlink:href=#E11-MJMATHI-63 y=0></use><use transform=scale(0.5) x=433 xlink:href=#E11-MJMAIN-2B y=0></use><use transform=scale(0.5) x=1212 xlink:href=#E11-MJMAIN-31 y=0></use></g></g></g></g></g></svg></span></span></p><p>发现因为他会把起点的子树也扫了一遍，产生多余的贡献，怎么办呢？</p><p>因为扫的过程中起点的子树里的点肯定会被扫两次，但贡献为 0。</p><p>所以可以开一个 <span class=arithmatex><span class=mjpage><svg viewbox="0 -755.5 1300.5 865.1"aria-labelledby=MathJax-SVG-12-Title focusable=false height=2.009ex role=img style=vertical-align:-0.255ex width=3.021ex xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title id=MathJax-SVG-12-Title>vis</title><defs aria-hidden=true><path d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"id=E12-MJMATHI-76 stroke-width=1></path><path d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"id=E12-MJMATHI-69 stroke-width=1></path><path d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"id=E12-MJMATHI-73 stroke-width=1></path></defs><g transform="matrix(1 0 0 -1 0 0)"aria-hidden=true fill=currentColor stroke=currentColor stroke-width=0><use x=0 xlink:href=#E12-MJMATHI-76 y=0></use><use x=485 xlink:href=#E12-MJMATHI-69 y=0></use><use x=831 xlink:href=#E12-MJMATHI-73 y=0></use></g></svg></span></span> 数组，每次扫到点 x，就把 <span class=arithmatex><span class=mjpage><svg viewbox="0 -755.5 1805.3 972.7"aria-labelledby=MathJax-SVG-13-Title focusable=false height=2.259ex role=img style=vertical-align:-0.505ex width=4.193ex xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title id=MathJax-SVG-13-Title>vis_x</title><defs aria-hidden=true><path d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"id=E13-MJMATHI-76 stroke-width=1></path><path d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"id=E13-MJMATHI-69 stroke-width=1></path><path d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"id=E13-MJMATHI-73 stroke-width=1></path><path d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"id=E13-MJMATHI-78 stroke-width=1></path></defs><g transform="matrix(1 0 0 -1 0 0)"aria-hidden=true fill=currentColor stroke=currentColor stroke-width=0><use x=0 xlink:href=#E13-MJMATHI-76 y=0></use><use x=485 xlink:href=#E13-MJMATHI-69 y=0></use><g transform=translate(831,0)><use x=0 xlink:href=#E13-MJMATHI-73 y=0></use><use transform=scale(0.707) x=663 xlink:href=#E13-MJMATHI-78 y=-213></use></g></g></svg></span></span> 异或上 1。</p><p>如果 <span class=arithmatex><span class=mjpage><svg viewbox="0 -755.5 3639.9 972.7"aria-labelledby=MathJax-SVG-14-Title focusable=false height=2.259ex role=img style=vertical-align:-0.505ex width=8.454ex xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title id=MathJax-SVG-14-Title>vis_x=0</title><defs aria-hidden=true><path d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"id=E14-MJMATHI-76 stroke-width=1></path><path d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"id=E14-MJMATHI-69 stroke-width=1></path><path d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"id=E14-MJMATHI-73 stroke-width=1></path><path d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"id=E14-MJMATHI-78 stroke-width=1></path><path d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"id=E14-MJMAIN-3D stroke-width=1></path><path d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"id=E14-MJMAIN-30 stroke-width=1></path></defs><g transform="matrix(1 0 0 -1 0 0)"aria-hidden=true fill=currentColor stroke=currentColor stroke-width=0><use x=0 xlink:href=#E14-MJMATHI-76 y=0></use><use x=485 xlink:href=#E14-MJMATHI-69 y=0></use><g transform=translate(831,0)><use x=0 xlink:href=#E14-MJMATHI-73 y=0></use><use transform=scale(0.707) x=663 xlink:href=#E14-MJMATHI-78 y=-213></use></g><use x=2083 xlink:href=#E14-MJMAIN-3D y=0></use><use x=3139 xlink:href=#E14-MJMAIN-30 y=0></use></g></svg></span></span>，那这个点的贡献就可以不计。</p><p>所以可以用树上莫队来求。</p><p>修改的话，加上一维时间维即可，变成带修改树上莫队。</p><p>然后因为所包含的区间内可能没有 LCA，对于没有的情况要将多余的贡献删除，然后就完事了。</p><details class=参考代码><summary>参考代码</summary> <div class=highlight><table class=highlighttable><tbody><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>  1</span>
<span class=normal>  2</span>
<span class=normal>  3</span>
<span class=normal>  4</span>
<span class=normal>  5</span>
<span class=normal>  6</span>
<span class=normal>  7</span>
<span class=normal>  8</span>
<span class=normal>  9</span>
<span class=normal> 10</span>
<span class=normal> 11</span>
<span class=normal> 12</span>
<span class=normal> 13</span>
<span class=normal> 14</span>
<span class=normal> 15</span>
<span class=normal> 16</span>
<span class=normal> 17</span>
<span class=normal> 18</span>
<span class=normal> 19</span>
<span class=normal> 20</span>
<span class=normal> 21</span>
<span class=normal> 22</span>
<span class=normal> 23</span>
<span class=normal> 24</span>
<span class=normal> 25</span>
<span class=normal> 26</span>
<span class=normal> 27</span>
<span class=normal> 28</span>
<span class=normal> 29</span>
<span class=normal> 30</span>
<span class=normal> 31</span>
<span class=normal> 32</span>
<span class=normal> 33</span>
<span class=normal> 34</span>
<span class=normal> 35</span>
<span class=normal> 36</span>
<span class=normal> 37</span>
<span class=normal> 38</span>
<span class=normal> 39</span>
<span class=normal> 40</span>
<span class=normal> 41</span>
<span class=normal> 42</span>
<span class=normal> 43</span>
<span class=normal> 44</span>
<span class=normal> 45</span>
<span class=normal> 46</span>
<span class=normal> 47</span>
<span class=normal> 48</span>
<span class=normal> 49</span>
<span class=normal> 50</span>
<span class=normal> 51</span>
<span class=normal> 52</span>
<span class=normal> 53</span>
<span class=normal> 54</span>
<span class=normal> 55</span>
<span class=normal> 56</span>
<span class=normal> 57</span>
<span class=normal> 58</span>
<span class=normal> 59</span>
<span class=normal> 60</span>
<span class=normal> 61</span>
<span class=normal> 62</span>
<span class=normal> 63</span>
<span class=normal> 64</span>
<span class=normal> 65</span>
<span class=normal> 66</span>
<span class=normal> 67</span>
<span class=normal> 68</span>
<span class=normal> 69</span>
<span class=normal> 70</span>
<span class=normal> 71</span>
<span class=normal> 72</span>
<span class=normal> 73</span>
<span class=normal> 74</span>
<span class=normal> 75</span>
<span class=normal> 76</span>
<span class=normal> 77</span>
<span class=normal> 78</span>
<span class=normal> 79</span>
<span class=normal> 80</span>
<span class=normal> 81</span>
<span class=normal> 82</span>
<span class=normal> 83</span>
<span class=normal> 84</span>
<span class=normal> 85</span>
<span class=normal> 86</span>
<span class=normal> 87</span>
<span class=normal> 88</span>
<span class=normal> 89</span>
<span class=normal> 90</span>
<span class=normal> 91</span>
<span class=normal> 92</span>
<span class=normal> 93</span>
<span class=normal> 94</span>
<span class=normal> 95</span>
<span class=normal> 96</span>
<span class=normal> 97</span>
<span class=normal> 98</span>
<span class=normal> 99</span>
<span class=normal>100</span>
<span class=normal>101</span>
<span class=normal>102</span>
<span class=normal>103</span>
<span class=normal>104</span>
<span class=normal>105</span>
<span class=normal>106</span>
<span class=normal>107</span>
<span class=normal>108</span>
<span class=normal>109</span>
<span class=normal>110</span>
<span class=normal>111</span>
<span class=normal>112</span>
<span class=normal>113</span>
<span class=normal>114</span>
<span class=normal>115</span>
<span class=normal>116</span>
<span class=normal>117</span>
<span class=normal>118</span>
<span class=normal>119</span>
<span class=normal>120</span>
<span class=normal>121</span>
<span class=normal>122</span>
<span class=normal>123</span>
<span class=normal>124</span>
<span class=normal>125</span>
<span class=normal>126</span>
<span class=normal>127</span>
<span class=normal>128</span>
<span class=normal>129</span>
<span class=normal>130</span>
<span class=normal>131</span>
<span class=normal>132</span>
<span class=normal>133</span>
<span class=normal>134</span>
<span class=normal>135</span>
<span class=normal>136</span>
<span class=normal>137</span>
<span class=normal>138</span>
<span class=normal>139</span>
<span class=normal>140</span>
<span class=normal>141</span>
<span class=normal>142</span>
<span class=normal>143</span>
<span class=normal>144</span>
<span class=normal>145</span>
<span class=normal>146</span>
<span class=normal>147</span>
<span class=normal>148</span>
<span class=normal>149</span>
<span class=normal>150</span>
<span class=normal>151</span>
<span class=normal>152</span>
<span class=normal>153</span>
<span class=normal>154</span></pre></div></td><td class=code><div><pre><span></span><code><span class=cp>#include</span><span class=w> </span><span class=cpf>&LTalgorithm></span><span class=cp></span>
<span class=cp>#include</span><span class=w> </span><span class=cpf>&LTcmath></span><span class=cp></span>
<span class=cp>#include</span><span class=w> </span><span class=cpf>&LTcstdio></span><span class=cp></span>
<span class=k>using</span><span class=w> </span><span class=k>namespace</span><span class=w> </span><span class=nn>std</span><span class=p>;</span><span class=w></span>

<span class=k>const</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>maxn</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>200010</span><span class=p>;</span><span class=w></span>

<span class=kt>int</span><span class=w> </span><span class=n>f</span><span class=p>[</span><span class=n>maxn</span><span class=p>],</span><span class=w> </span><span class=n>g</span><span class=p>[</span><span class=n>maxn</span><span class=p>],</span><span class=w> </span><span class=n>id</span><span class=p>[</span><span class=n>maxn</span><span class=p>],</span><span class=w> </span><span class=n>head</span><span class=p>[</span><span class=n>maxn</span><span class=p>],</span><span class=w> </span><span class=n>cnt</span><span class=p>,</span><span class=w> </span><span class=n>last</span><span class=p>[</span><span class=n>maxn</span><span class=p>],</span><span class=w> </span><span class=n>dep</span><span class=p>[</span><span class=n>maxn</span><span class=p>],</span><span class=w></span>
<span class=w>    </span><span class=n>fa</span><span class=p>[</span><span class=n>maxn</span><span class=p>][</span><span class=mi>22</span><span class=p>],</span><span class=w> </span><span class=n>v</span><span class=p>[</span><span class=n>maxn</span><span class=p>],</span><span class=w> </span><span class=n>w</span><span class=p>[</span><span class=n>maxn</span><span class=p>];</span><span class=w></span>
<span class=kt>int</span><span class=w> </span><span class=n>block</span><span class=p>,</span><span class=w> </span><span class=n>index</span><span class=p>,</span><span class=w> </span><span class=n>n</span><span class=p>,</span><span class=w> </span><span class=n>m</span><span class=p>,</span><span class=w> </span><span class=n>q</span><span class=p>;</span><span class=w></span>
<span class=kt>int</span><span class=w> </span><span class=n>pos</span><span class=p>[</span><span class=n>maxn</span><span class=p>],</span><span class=w> </span><span class=n>col</span><span class=p>[</span><span class=n>maxn</span><span class=p>],</span><span class=w> </span><span class=n>app</span><span class=p>[</span><span class=n>maxn</span><span class=p>];</span><span class=w></span>
<span class=kt>bool</span><span class=w> </span><span class=n>vis</span><span class=p>[</span><span class=n>maxn</span><span class=p>];</span><span class=w></span>
<span class=kt>long</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=n>ans</span><span class=p>[</span><span class=n>maxn</span><span class=p>],</span><span class=w> </span><span class=n>cur</span><span class=p>;</span><span class=w></span>

<span class=k>struct</span><span class=w> </span><span class=nc>edge</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=kt>int</span><span class=w> </span><span class=n>to</span><span class=p>,</span><span class=w> </span><span class=n>nxt</span><span class=p>;</span><span class=w></span>
<span class=p>}</span><span class=w> </span><span class=n>e</span><span class=p>[</span><span class=n>maxn</span><span class=p>];</span><span class=w></span>

<span class=kt>int</span><span class=w> </span><span class=n>cnt1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=n>cnt2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w>  </span><span class=c1>// 时间戳</span>

<span class=k>struct</span><span class=w> </span><span class=nc>query</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=kt>int</span><span class=w> </span><span class=n>l</span><span class=p>,</span><span class=w> </span><span class=n>r</span><span class=p>,</span><span class=w> </span><span class=n>t</span><span class=p>,</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w></span>

<span class=w>  </span><span class=kt>bool</span><span class=w> </span><span class=k>operator</span><span class=o><</span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=n>query</span><span class=w> </span><span class=o>&</span><span class=n>b</span><span class=p>)</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span><span class=n>pos</span><span class=p>[</span><span class=n>l</span><span class=p>]</span><span class=w> </span><span class=o><</span><span class=w> </span><span class=n>pos</span><span class=p>[</span><span class=n>b</span><span class=p>.</span><span class=n>l</span><span class=p>])</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=p>(</span><span class=n>pos</span><span class=p>[</span><span class=n>l</span><span class=p>]</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>pos</span><span class=p>[</span><span class=n>b</span><span class=p>.</span><span class=n>l</span><span class=p>]</span><span class=w> </span><span class=o>&&</span><span class=w> </span><span class=n>pos</span><span class=p>[</span><span class=n>r</span><span class=p>]</span><span class=w> </span><span class=o><</span><span class=w> </span><span class=n>pos</span><span class=p>[</span><span class=n>b</span><span class=p>.</span><span class=n>r</span><span class=p>])</span><span class=w> </span><span class=o>||</span><span class=w></span>
<span class=w>           </span><span class=p>(</span><span class=n>pos</span><span class=p>[</span><span class=n>l</span><span class=p>]</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>pos</span><span class=p>[</span><span class=n>b</span><span class=p>.</span><span class=n>l</span><span class=p>]</span><span class=w> </span><span class=o>&&</span><span class=w> </span><span class=n>pos</span><span class=p>[</span><span class=n>r</span><span class=p>]</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>pos</span><span class=p>[</span><span class=n>b</span><span class=p>.</span><span class=n>r</span><span class=p>]</span><span class=w> </span><span class=o>&&</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=o><</span><span class=w> </span><span class=n>b</span><span class=p>.</span><span class=n>t</span><span class=p>);</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w></span>
<span class=p>}</span><span class=w> </span><span class=n>a</span><span class=p>[</span><span class=n>maxn</span><span class=p>],</span><span class=w> </span><span class=n>b</span><span class=p>[</span><span class=n>maxn</span><span class=p>];</span><span class=w></span>

<span class=kr>inline</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>addedge</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>y</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=n>e</span><span class=p>[</span><span class=o>++</span><span class=n>cnt</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>edge</span><span class=p>){</span><span class=n>y</span><span class=p>,</span><span class=w> </span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>]};</span><span class=w></span>
<span class=w>  </span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>cnt</span><span class=p>;</span><span class=w></span>
<span class=p>}</span><span class=w></span>

<span class=kt>void</span><span class=w> </span><span class=nf>dfs</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>x</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=n>id</span><span class=p>[</span><span class=n>f</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>++</span><span class=n>index</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>x</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=w> </span><span class=n>i</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>nxt</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>fa</span><span class=p>[</span><span class=n>x</span><span class=p>][</span><span class=mi>0</span><span class=p>])</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>      </span><span class=n>fa</span><span class=p>[</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>x</span><span class=p>;</span><span class=w></span>
<span class=w>      </span><span class=n>dep</span><span class=p>[</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w></span>
<span class=w>      </span><span class=n>dfs</span><span class=p>(</span><span class=n>e</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>to</span><span class=p>);</span><span class=w></span>
<span class=w>    </span><span class=p>}</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w></span>
<span class=w>  </span><span class=n>id</span><span class=p>[</span><span class=n>g</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>++</span><span class=n>index</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>x</span><span class=p>;</span><span class=w>  </span><span class=c1>// 括号序</span>
<span class=p>}</span><span class=w></span>

<span class=kr>inline</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=nf>lca</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>y</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=w> </span><span class=o><</span><span class=w> </span><span class=n>dep</span><span class=p>[</span><span class=n>y</span><span class=p>])</span><span class=w> </span><span class=n>swap</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=n>y</span><span class=p>);</span><span class=w></span>
<span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>dep</span><span class=p>[</span><span class=n>y</span><span class=p>])</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>dis</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>dep</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>dep</span><span class=p>[</span><span class=n>y</span><span class=p>];</span><span class=w></span>
<span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>20</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>--</span><span class=p>)</span><span class=w></span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>dis</span><span class=w> </span><span class=o>>=</span><span class=w> </span><span class=p>(</span><span class=mi>1</span><span class=w> </span><span class=o><<</span><span class=w> </span><span class=n>i</span><span class=p>))</span><span class=w> </span><span class=n>dis</span><span class=w> </span><span class=o>-=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=o><<</span><span class=w> </span><span class=n>i</span><span class=p>,</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>fa</span><span class=p>[</span><span class=n>x</span><span class=p>][</span><span class=n>i</span><span class=p>];</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w>  </span><span class=c1>// 爬到同一高度</span>
<span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>x</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>y</span><span class=p>)</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=n>x</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>20</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>--</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>fa</span><span class=p>[</span><span class=n>x</span><span class=p>][</span><span class=n>i</span><span class=p>]</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>fa</span><span class=p>[</span><span class=n>y</span><span class=p>][</span><span class=n>i</span><span class=p>])</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>fa</span><span class=p>[</span><span class=n>x</span><span class=p>][</span><span class=n>i</span><span class=p>],</span><span class=w> </span><span class=n>y</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>fa</span><span class=p>[</span><span class=n>y</span><span class=p>][</span><span class=n>i</span><span class=p>];</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w></span>
<span class=w>  </span><span class=k>return</span><span class=w> </span><span class=n>fa</span><span class=p>[</span><span class=n>x</span><span class=p>][</span><span class=mi>0</span><span class=p>];</span><span class=w></span>
<span class=p>}</span><span class=w></span>

<span class=kr>inline</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>add</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>x</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>vis</span><span class=p>[</span><span class=n>x</span><span class=p>])</span><span class=w></span>
<span class=w>    </span><span class=n>cur</span><span class=w> </span><span class=o>-=</span><span class=w> </span><span class=p>(</span><span class=kt>long</span><span class=w> </span><span class=kt>long</span><span class=p>)</span><span class=n>v</span><span class=p>[</span><span class=n>col</span><span class=p>[</span><span class=n>x</span><span class=p>]]</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>w</span><span class=p>[</span><span class=n>app</span><span class=p>[</span><span class=n>col</span><span class=p>[</span><span class=n>x</span><span class=p>]]</span><span class=o>--</span><span class=p>];</span><span class=w></span>
<span class=w>  </span><span class=k>else</span><span class=w></span>
<span class=w>    </span><span class=n>cur</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=p>(</span><span class=kt>long</span><span class=w> </span><span class=kt>long</span><span class=p>)</span><span class=n>v</span><span class=p>[</span><span class=n>col</span><span class=p>[</span><span class=n>x</span><span class=p>]]</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>w</span><span class=p>[</span><span class=o>++</span><span class=n>app</span><span class=p>[</span><span class=n>col</span><span class=p>[</span><span class=n>x</span><span class=p>]]];</span><span class=w></span>
<span class=w>  </span><span class=n>vis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=w> </span><span class=o>^=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w></span>
<span class=p>}</span><span class=w></span>

<span class=kr>inline</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>modify</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>t</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>vis</span><span class=p>[</span><span class=n>x</span><span class=p>])</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=n>add</span><span class=p>(</span><span class=n>x</span><span class=p>);</span><span class=w></span>
<span class=w>    </span><span class=n>col</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>t</span><span class=p>;</span><span class=w></span>
<span class=w>    </span><span class=n>add</span><span class=p>(</span><span class=n>x</span><span class=p>);</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w></span>
<span class=w>    </span><span class=n>col</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>t</span><span class=p>;</span><span class=w></span>
<span class=p>}</span><span class=w>  </span><span class=c1>// 在时间维上移动</span>

<span class=kt>int</span><span class=w> </span><span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=n>scanf</span><span class=p>(</span><span class=s>"%d%d%d"</span><span class=p>,</span><span class=w> </span><span class=o>&</span><span class=n>n</span><span class=p>,</span><span class=w> </span><span class=o>&</span><span class=n>m</span><span class=p>,</span><span class=w> </span><span class=o>&</span><span class=n>q</span><span class=p>);</span><span class=w></span>
<span class=w>  </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o><=</span><span class=w> </span><span class=n>m</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=n>scanf</span><span class=p>(</span><span class=s>"%d"</span><span class=p>,</span><span class=w> </span><span class=o>&</span><span class=n>v</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span><span class=w></span>
<span class=w>  </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o><=</span><span class=w> </span><span class=n>n</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=n>scanf</span><span class=p>(</span><span class=s>"%d"</span><span class=p>,</span><span class=w> </span><span class=o>&</span><span class=n>w</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span><span class=w></span>
<span class=w>  </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o><</span><span class=w> </span><span class=n>n</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=n>y</span><span class=p>;</span><span class=w></span>
<span class=w>    </span><span class=n>scanf</span><span class=p>(</span><span class=s>"%d%d"</span><span class=p>,</span><span class=w> </span><span class=o>&</span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=o>&</span><span class=n>y</span><span class=p>);</span><span class=w></span>
<span class=w>    </span><span class=n>addedge</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=n>y</span><span class=p>);</span><span class=w></span>
<span class=w>    </span><span class=n>addedge</span><span class=p>(</span><span class=n>y</span><span class=p>,</span><span class=w> </span><span class=n>x</span><span class=p>);</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w></span>
<span class=w>  </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o><=</span><span class=w> </span><span class=n>n</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=n>scanf</span><span class=p>(</span><span class=s>"%d"</span><span class=p>,</span><span class=w> </span><span class=o>&</span><span class=n>last</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span><span class=w></span>
<span class=w>    </span><span class=n>col</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>last</span><span class=p>[</span><span class=n>i</span><span class=p>];</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w></span>
<span class=w>  </span><span class=n>dfs</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span><span class=w></span>
<span class=w>  </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>j</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w> </span><span class=n>j</span><span class=w> </span><span class=o><=</span><span class=w> </span><span class=mi>20</span><span class=p>;</span><span class=w> </span><span class=n>j</span><span class=o>++</span><span class=p>)</span><span class=w></span>
<span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o><=</span><span class=w> </span><span class=n>n</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w></span>
<span class=w>      </span><span class=n>fa</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>fa</span><span class=p>[</span><span class=n>fa</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>1</span><span class=p>]][</span><span class=n>j</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>1</span><span class=p>];</span><span class=w>  </span><span class=c1>// 预处理祖先</span>
<span class=w>  </span><span class=kt>int</span><span class=w> </span><span class=n>block</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>pow</span><span class=p>(</span><span class=n>index</span><span class=p>,</span><span class=w> </span><span class=mf>2.0</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>3</span><span class=p>);</span><span class=w></span>
<span class=w>  </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o><=</span><span class=w> </span><span class=n>index</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=n>pos</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>i</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=n>block</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w></span>
<span class=w>  </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>q</span><span class=o>--</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>opt</span><span class=p>,</span><span class=w> </span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=n>y</span><span class=p>;</span><span class=w></span>
<span class=w>    </span><span class=n>scanf</span><span class=p>(</span><span class=s>"%d%d%d"</span><span class=p>,</span><span class=w> </span><span class=o>&</span><span class=n>opt</span><span class=p>,</span><span class=w> </span><span class=o>&</span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=o>&</span><span class=n>y</span><span class=p>);</span><span class=w></span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>opt</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>      </span><span class=n>b</span><span class=p>[</span><span class=o>++</span><span class=n>cnt2</span><span class=p>].</span><span class=n>l</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>x</span><span class=p>;</span><span class=w></span>
<span class=w>      </span><span class=n>b</span><span class=p>[</span><span class=n>cnt2</span><span class=p>].</span><span class=n>r</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>last</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=w></span>
<span class=w>      </span><span class=n>last</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>b</span><span class=p>[</span><span class=n>cnt2</span><span class=p>].</span><span class=n>t</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>y</span><span class=p>;</span><span class=w></span>
<span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>f</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=w> </span><span class=o>></span><span class=w> </span><span class=n>f</span><span class=p>[</span><span class=n>y</span><span class=p>])</span><span class=w> </span><span class=n>swap</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=n>y</span><span class=p>);</span><span class=w></span>
<span class=w>      </span><span class=n>a</span><span class=p>[</span><span class=o>++</span><span class=n>cnt1</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>query</span><span class=p>){</span><span class=n>lca</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=n>y</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>f</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>g</span><span class=p>[</span><span class=n>x</span><span class=p>],</span><span class=w> </span><span class=n>f</span><span class=p>[</span><span class=n>y</span><span class=p>],</span><span class=w> </span><span class=n>cnt2</span><span class=p>,</span><span class=w> </span><span class=n>cnt1</span><span class=p>};</span><span class=w></span>
<span class=w>    </span><span class=p>}</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w></span>
<span class=w>  </span><span class=n>sort</span><span class=p>(</span><span class=n>a</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>cnt1</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=p>);</span><span class=w></span>
<span class=w>  </span><span class=kt>int</span><span class=w> </span><span class=n>L</span><span class=p>,</span><span class=w> </span><span class=n>R</span><span class=p>,</span><span class=w> </span><span class=n>T</span><span class=p>;</span><span class=w>  </span><span class=c1>// 指针坐标</span>
<span class=w>  </span><span class=n>L</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>R</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=n>T</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o><=</span><span class=w> </span><span class=n>cnt1</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>T</span><span class=w> </span><span class=o><=</span><span class=w> </span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>t</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>      </span><span class=n>modify</span><span class=p>(</span><span class=n>b</span><span class=p>[</span><span class=n>T</span><span class=p>].</span><span class=n>l</span><span class=p>,</span><span class=w> </span><span class=n>b</span><span class=p>[</span><span class=n>T</span><span class=p>].</span><span class=n>t</span><span class=p>);</span><span class=w></span>
<span class=w>      </span><span class=n>T</span><span class=o>++</span><span class=p>;</span><span class=w></span>
<span class=w>    </span><span class=p>}</span><span class=w></span>
<span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>T</span><span class=w> </span><span class=o>></span><span class=w> </span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>t</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>      </span><span class=n>modify</span><span class=p>(</span><span class=n>b</span><span class=p>[</span><span class=n>T</span><span class=p>].</span><span class=n>l</span><span class=p>,</span><span class=w> </span><span class=n>b</span><span class=p>[</span><span class=n>T</span><span class=p>].</span><span class=n>r</span><span class=p>);</span><span class=w></span>
<span class=w>      </span><span class=n>T</span><span class=o>--</span><span class=p>;</span><span class=w></span>
<span class=w>    </span><span class=p>}</span><span class=w></span>
<span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>L</span><span class=w> </span><span class=o>></span><span class=w> </span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>l</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>      </span><span class=n>L</span><span class=o>--</span><span class=p>;</span><span class=w></span>
<span class=w>      </span><span class=n>add</span><span class=p>(</span><span class=n>id</span><span class=p>[</span><span class=n>L</span><span class=p>]);</span><span class=w></span>
<span class=w>    </span><span class=p>}</span><span class=w></span>
<span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>L</span><span class=w> </span><span class=o><</span><span class=w> </span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>l</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>      </span><span class=n>add</span><span class=p>(</span><span class=n>id</span><span class=p>[</span><span class=n>L</span><span class=p>]);</span><span class=w></span>
<span class=w>      </span><span class=n>L</span><span class=o>++</span><span class=p>;</span><span class=w></span>
<span class=w>    </span><span class=p>}</span><span class=w></span>
<span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>R</span><span class=w> </span><span class=o>></span><span class=w> </span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>r</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>      </span><span class=n>add</span><span class=p>(</span><span class=n>id</span><span class=p>[</span><span class=n>R</span><span class=p>]);</span><span class=w></span>
<span class=w>      </span><span class=n>R</span><span class=o>--</span><span class=p>;</span><span class=w></span>
<span class=w>    </span><span class=p>}</span><span class=w></span>
<span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>R</span><span class=w> </span><span class=o><</span><span class=w> </span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>r</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>      </span><span class=n>R</span><span class=o>++</span><span class=p>;</span><span class=w></span>
<span class=w>      </span><span class=n>add</span><span class=p>(</span><span class=n>id</span><span class=p>[</span><span class=n>R</span><span class=p>]);</span><span class=w></span>
<span class=w>    </span><span class=p>}</span><span class=w></span>
<span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>id</span><span class=p>[</span><span class=n>L</span><span class=p>],</span><span class=w> </span><span class=n>y</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>id</span><span class=p>[</span><span class=n>R</span><span class=p>];</span><span class=w></span>
<span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>llca</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>lca</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=n>y</span><span class=p>);</span><span class=w></span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>x</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>llca</span><span class=w> </span><span class=o>&&</span><span class=w> </span><span class=n>y</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>llca</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>      </span><span class=n>add</span><span class=p>(</span><span class=n>llca</span><span class=p>);</span><span class=w></span>
<span class=w>      </span><span class=n>ans</span><span class=p>[</span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>id</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>cur</span><span class=p>;</span><span class=w></span>
<span class=w>      </span><span class=n>add</span><span class=p>(</span><span class=n>llca</span><span class=p>);</span><span class=w></span>
<span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w></span>
<span class=w>      </span><span class=n>ans</span><span class=p>[</span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>id</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>cur</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w></span>
<span class=w>  </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o><=</span><span class=w> </span><span class=n>cnt1</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=n>printf</span><span class=p>(</span><span class=s>"%lld</span><span class=se>\n</span><span class=s>"</span><span class=p>,</span><span class=w> </span><span class=n>ans</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w></span>
<span class=w>  </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div></td></tr></tbody></table></div></details><h2 id=_2>真·树上莫队<a title="Permanent link"class=headerlink href=#_2>¶</a></h2><p>上面的树上莫队只是将树转化成了链，下面的才是真正的树上莫队。</p><p>由于莫队相关的问题都是模板题，因此实现部分不做太多解释</p><h3 id=_3>询问的排序<a title="Permanent link"class=headerlink href=#_3>¶</a></h3><p>首先我们知道莫队的是基于分块的算法，所以我们需要找到一种树上的分块方法来保证时间复杂度。</p><p>条件：</p><ul><li>属于同一块的节点之间的距离不超过给定块的大小</li><li>每个块中的节点不能太多也不能太少</li><li>每个节点都要属于一个块</li><li>编号相邻的块之间的距离不能太大</li></ul><p>了解了这些条件后，我们看到这样一道题 <a href=https://loj.ac/problem/2152>「SCOI2005」王室联邦</a>。</p><p>在这道题的基础上我们只要保证最后一个条件就可以解决分块的问题了。</p><div class="admonition 思路"><p class=admonition-title>思路</p><p>令 lim 为希望块的大小，首先，对于整个树 dfs，当子树的大小大于 lim 时，就将它们分在一块，容易想到：对于根，可能会剩下一些点，于是将这些点分在最后一个块里。</p></div><p>做法：用栈维护当前节点作为父节点访问它的子节点，当从栈顶到父节点的距离大于希望块的大小时，弹出这部分元素分为一块，最后剩余的一块单独作为一块。</p><p>最后的排序方法：若第一维时间戳大于第二维，交换它们，按第一维所属块为第一关键字，第二维时间戳为第二关键字排序。</p><h3 id=_4>指针的移动<a title="Permanent link"class=headerlink href=#_4>¶</a></h3><p>容易想到，我们可以标记被计入答案的点，让指针直接向目标移动，同时取反路径上的点。</p><p>但是，这样有一个问题，若指针一开始都在 x 上，显然 x 被标记，当两个指针向同一子节点移动（还有许多情况）时，x 应该不被标记，但实际情况是 x 被标记，因为两个指针分别标记了一次，抵消了。</p><p>如何解决呢？</p><p>有一个很显然的性质：这些点肯定是某些 LCA，因为 LCA 处才有可能被重复撤销导致撤销失败。</p><p>所以我们每次不标记 LCA，到需要询问答案时再将 LCA 标记，然后再撤销。</p><div class=highlight><table class=highlighttable><tbody><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span></pre></div></td><td class=code><div><pre><span></span><code><span class=c1>// 取反路径上除LCA以外的所有节点</span>
<span class=kt>void</span><span class=w> </span><span class=nf>move</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>y</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>dp</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=w> </span><span class=o><</span><span class=w> </span><span class=n>dp</span><span class=p>[</span><span class=n>y</span><span class=p>])</span><span class=w> </span><span class=n>swap</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=n>y</span><span class=p>);</span><span class=w></span>
<span class=w>  </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>dp</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=w> </span><span class=o>></span><span class=w> </span><span class=n>dp</span><span class=p>[</span><span class=n>y</span><span class=p>])</span><span class=w> </span><span class=n>update</span><span class=p>(</span><span class=n>x</span><span class=p>),</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>fa</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=w></span>
<span class=w>  </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>x</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>y</span><span class=p>)</span><span class=w> </span><span class=n>update</span><span class=p>(</span><span class=n>x</span><span class=p>),</span><span class=w> </span><span class=n>update</span><span class=p>(</span><span class=n>y</span><span class=p>),</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>fa</span><span class=p>[</span><span class=n>x</span><span class=p>],</span><span class=w> </span><span class=n>y</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>fa</span><span class=p>[</span><span class=n>y</span><span class=p>];</span><span class=w></span>
<span class=w>  </span><span class=c1>// x!=y保证LCA没被取反</span>
<span class=p>}</span><span class=w></span>
</code></pre></div></td></tr></tbody></table></div><p>对于求 LCA，我们可以用树剖，然后我们就可以把分块的步骤放到树剖的第一次 dfs 里面，时间戳也可以直接用第二次 dfs 的 dfs 序。</p><div class=highlight><table class=highlighttable><tbody><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span></pre></div></td><td class=code><div><pre><span></span><code><span class=kt>int</span><span class=w> </span><span class=n>bl</span><span class=p>[</span><span class=mi>100002</span><span class=p>],</span><span class=w> </span><span class=n>bls</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w>  </span><span class=c1>// 属于的块，块的数量</span>
<span class=kt>unsigned</span><span class=w> </span><span class=n>step</span><span class=p>;</span><span class=w>            </span><span class=c1>// 块大小</span>
<span class=kt>int</span><span class=w> </span><span class=n>fa</span><span class=p>[</span><span class=mi>100002</span><span class=p>],</span><span class=w> </span><span class=n>dp</span><span class=p>[</span><span class=mi>100002</span><span class=p>],</span><span class=w> </span><span class=n>hs</span><span class=p>[</span><span class=mi>100002</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=mi>0</span><span class=p>},</span><span class=w> </span><span class=n>sz</span><span class=p>[</span><span class=mi>100002</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=mi>0</span><span class=p>};</span><span class=w></span>
<span class=c1>// 父节点，深度，重儿子，大小</span>
<span class=n>stack</span><span class=o><</span><span class=kt>int</span><span class=o>></span><span class=w> </span><span class=n>sta</span><span class=p>;</span><span class=w></span>

<span class=kt>void</span><span class=w> </span><span class=nf>dfs1</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>x</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=n>sz</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=kt>unsigned</span><span class=w> </span><span class=n>ss</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sta</span><span class=p>.</span><span class=n>size</span><span class=p>();</span><span class=w></span>
<span class=w>  </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=w> </span><span class=n>i</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>nxt</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=w></span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>ver</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>fa</span><span class=p>[</span><span class=n>x</span><span class=p>])</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>      </span><span class=n>fa</span><span class=p>[</span><span class=n>ver</span><span class=p>[</span><span class=n>i</span><span class=p>]]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>x</span><span class=p>;</span><span class=w></span>
<span class=w>      </span><span class=n>dp</span><span class=p>[</span><span class=n>ver</span><span class=p>[</span><span class=n>i</span><span class=p>]]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>dp</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w></span>
<span class=w>      </span><span class=n>dfs1</span><span class=p>(</span><span class=n>ver</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span><span class=w></span>
<span class=w>      </span><span class=n>sz</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=n>sz</span><span class=p>[</span><span class=n>ver</span><span class=p>[</span><span class=n>i</span><span class=p>]];</span><span class=w></span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>sz</span><span class=p>[</span><span class=n>ver</span><span class=p>[</span><span class=n>i</span><span class=p>]]</span><span class=w> </span><span class=o>></span><span class=w> </span><span class=n>sz</span><span class=p>[</span><span class=n>hs</span><span class=p>[</span><span class=n>x</span><span class=p>]])</span><span class=w> </span><span class=n>hs</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ver</span><span class=p>[</span><span class=n>i</span><span class=p>];</span><span class=w></span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>sta</span><span class=p>.</span><span class=n>size</span><span class=p>()</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>ss</span><span class=w> </span><span class=o>>=</span><span class=w> </span><span class=n>step</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>        </span><span class=n>bls</span><span class=o>++</span><span class=p>;</span><span class=w></span>
<span class=w>        </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>sta</span><span class=p>.</span><span class=n>size</span><span class=p>()</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>ss</span><span class=p>)</span><span class=w> </span><span class=n>bl</span><span class=p>[</span><span class=n>sta</span><span class=p>.</span><span class=n>top</span><span class=p>()]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>bls</span><span class=p>,</span><span class=w> </span><span class=n>sta</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span><span class=w></span>
<span class=w>      </span><span class=p>}</span><span class=w></span>
<span class=w>    </span><span class=p>}</span><span class=w></span>
<span class=w>  </span><span class=n>sta</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>x</span><span class=p>);</span><span class=w></span>
<span class=p>}</span><span class=w></span>

<span class=c1>// main</span>
<span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>sta</span><span class=p>.</span><span class=n>empty</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=n>bls</span><span class=o>++</span><span class=p>;</span><span class=w>  </span><span class=c1>// 这一行可写可不写</span>
<span class=w>  </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>sta</span><span class=p>.</span><span class=n>empty</span><span class=p>())</span><span class=w> </span><span class=n>bl</span><span class=p>[</span><span class=n>sta</span><span class=p>.</span><span class=n>top</span><span class=p>()]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>bls</span><span class=p>,</span><span class=w> </span><span class=n>sta</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div></td></tr></tbody></table></div><h3 id=_5>时间复杂度<a title="Permanent link"class=headerlink href=#_5>¶</a></h3><p>重点到了，这里关系到块的大小取值。</p><p>设块的大小为 <span class=arithmatex><span class=mjpage><svg viewbox="0 -755.5 1880 865.1"aria-labelledby=MathJax-SVG-15-Title focusable=false height=2.009ex role=img style=vertical-align:-0.255ex width=4.366ex xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title id=MathJax-SVG-15-Title>unit</title><defs aria-hidden=true><path d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"id=E15-MJMATHI-75 stroke-width=1></path><path d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"id=E15-MJMATHI-6E stroke-width=1></path><path d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"id=E15-MJMATHI-69 stroke-width=1></path><path d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"id=E15-MJMATHI-74 stroke-width=1></path></defs><g transform="matrix(1 0 0 -1 0 0)"aria-hidden=true fill=currentColor stroke=currentColor stroke-width=0><use x=0 xlink:href=#E15-MJMATHI-75 y=0></use><use x=572 xlink:href=#E15-MJMATHI-6E y=0></use><use x=1173 xlink:href=#E15-MJMATHI-69 y=0></use><use x=1518 xlink:href=#E15-MJMATHI-74 y=0></use></g></svg></span></span>：</p><ul><li>对于 x 指针，由于每个块中节点的距离在 <span class=arithmatex><span class=mjpage><svg viewbox="0 -755.5 1880 865.1"aria-labelledby=MathJax-SVG-16-Title focusable=false height=2.009ex role=img style=vertical-align:-0.255ex width=4.366ex xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title id=MathJax-SVG-16-Title>unit</title><defs aria-hidden=true><path d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"id=E16-MJMATHI-75 stroke-width=1></path><path d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"id=E16-MJMATHI-6E stroke-width=1></path><path d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"id=E16-MJMATHI-69 stroke-width=1></path><path d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"id=E16-MJMATHI-74 stroke-width=1></path></defs><g transform="matrix(1 0 0 -1 0 0)"aria-hidden=true fill=currentColor stroke=currentColor stroke-width=0><use x=0 xlink:href=#E16-MJMATHI-75 y=0></use><use x=572 xlink:href=#E16-MJMATHI-6E y=0></use><use x=1173 xlink:href=#E16-MJMATHI-69 y=0></use><use x=1518 xlink:href=#E16-MJMATHI-74 y=0></use></g></svg></span></span> 左右，每个块中 x 指针移动 <span class=arithmatex><span class=mjpage><svg viewbox="0 -916.9 2333.9 1026.6"aria-labelledby=MathJax-SVG-17-Title focusable=false height=2.384ex role=img style=vertical-align:-0.255ex width=5.421ex xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title id=MathJax-SVG-17-Title>unit^2</title><defs aria-hidden=true><path d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"id=E17-MJMATHI-75 stroke-width=1></path><path d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"id=E17-MJMATHI-6E stroke-width=1></path><path d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"id=E17-MJMATHI-69 stroke-width=1></path><path d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"id=E17-MJMATHI-74 stroke-width=1></path><path d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"id=E17-MJMAIN-32 stroke-width=1></path></defs><g transform="matrix(1 0 0 -1 0 0)"aria-hidden=true fill=currentColor stroke=currentColor stroke-width=0><use x=0 xlink:href=#E17-MJMATHI-75 y=0></use><use x=572 xlink:href=#E17-MJMATHI-6E y=0></use><use x=1173 xlink:href=#E17-MJMATHI-69 y=0></use><g transform=translate(1518,0)><use x=0 xlink:href=#E17-MJMATHI-74 y=0></use><use transform=scale(0.707) x=511 xlink:href=#E17-MJMAIN-32 y=513></use></g></g></svg></span></span> 次（<span class=arithmatex><span class=mjpage><svg viewbox="0 -755.5 5941.9 972.7"aria-labelledby=MathJax-SVG-18-Title focusable=false height=2.259ex role=img style=vertical-align:-0.505ex width=13.801ex xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title id=MathJax-SVG-18-Title>unit\times dis_{max}</title><defs aria-hidden=true><path d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"id=E18-MJMATHI-75 stroke-width=1></path><path d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"id=E18-MJMATHI-6E stroke-width=1></path><path d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"id=E18-MJMATHI-69 stroke-width=1></path><path d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"id=E18-MJMATHI-74 stroke-width=1></path><path d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z"id=E18-MJMAIN-D7 stroke-width=1></path><path d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"id=E18-MJMATHI-64 stroke-width=1></path><path d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"id=E18-MJMATHI-73 stroke-width=1></path><path d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"id=E18-MJMATHI-6D stroke-width=1></path><path d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"id=E18-MJMATHI-61 stroke-width=1></path><path d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"id=E18-MJMATHI-78 stroke-width=1></path></defs><g transform="matrix(1 0 0 -1 0 0)"aria-hidden=true fill=currentColor stroke=currentColor stroke-width=0><use x=0 xlink:href=#E18-MJMATHI-75 y=0></use><use x=572 xlink:href=#E18-MJMATHI-6E y=0></use><use x=1173 xlink:href=#E18-MJMATHI-69 y=0></use><use x=1518 xlink:href=#E18-MJMATHI-74 y=0></use><use x=2102 xlink:href=#E18-MJMAIN-D7 y=0></use><use x=3102 xlink:href=#E18-MJMATHI-64 y=0></use><use x=3626 xlink:href=#E18-MJMATHI-69 y=0></use><g transform=translate(3971,0)><use x=0 xlink:href=#E18-MJMATHI-73 y=0></use><g transform=translate(469,-150)><use transform=scale(0.707) x=0 xlink:href=#E18-MJMATHI-6D y=0></use><use transform=scale(0.707) x=878 xlink:href=#E18-MJMATHI-61 y=0></use><use transform=scale(0.707) x=1408 xlink:href=#E18-MJMATHI-78 y=0></use></g></g></g></svg></span></span>），共计 <span class=arithmatex><span class=mjpage><svg viewbox="0 -755.5 3703.4 865.1"aria-labelledby=MathJax-SVG-19-Title focusable=false height=2.009ex role=img style=vertical-align:-0.255ex width=8.602ex xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title id=MathJax-SVG-19-Title>n\times unit</title><defs aria-hidden=true><path d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"id=E19-MJMATHI-6E stroke-width=1></path><path d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z"id=E19-MJMAIN-D7 stroke-width=1></path><path d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"id=E19-MJMATHI-75 stroke-width=1></path><path d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"id=E19-MJMATHI-69 stroke-width=1></path><path d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"id=E19-MJMATHI-74 stroke-width=1></path></defs><g transform="matrix(1 0 0 -1 0 0)"aria-hidden=true fill=currentColor stroke=currentColor stroke-width=0><use x=0 xlink:href=#E19-MJMATHI-6E y=0></use><use x=822 xlink:href=#E19-MJMAIN-D7 y=0></use><use x=1823 xlink:href=#E19-MJMATHI-75 y=0></use><use x=2395 xlink:href=#E19-MJMATHI-6E y=0></use><use x=2996 xlink:href=#E19-MJMATHI-69 y=0></use><use x=3341 xlink:href=#E19-MJMATHI-74 y=0></use></g></svg></span></span> 次（<span class=arithmatex><span class=mjpage><svg viewbox="0 -916.9 6025.2 1403.3"aria-labelledby=MathJax-SVG-20-Title focusable=false height=3.259ex role=img style=vertical-align:-1.13ex width=13.994ex xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title id=MathJax-SVG-20-Title>unit^2 \times (\frac{n}{unit})</title><defs aria-hidden=true><path d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"id=E20-MJMATHI-75 stroke-width=1></path><path d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"id=E20-MJMATHI-6E stroke-width=1></path><path d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"id=E20-MJMATHI-69 stroke-width=1></path><path d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"id=E20-MJMATHI-74 stroke-width=1></path><path d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"id=E20-MJMAIN-32 stroke-width=1></path><path d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z"id=E20-MJMAIN-D7 stroke-width=1></path><path d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"id=E20-MJMAIN-28 stroke-width=1></path><path d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"id=E20-MJMAIN-29 stroke-width=1></path></defs><g transform="matrix(1 0 0 -1 0 0)"aria-hidden=true fill=currentColor stroke=currentColor stroke-width=0><use x=0 xlink:href=#E20-MJMATHI-75 y=0></use><use x=572 xlink:href=#E20-MJMATHI-6E y=0></use><use x=1173 xlink:href=#E20-MJMATHI-69 y=0></use><g transform=translate(1518,0)><use x=0 xlink:href=#E20-MJMATHI-74 y=0></use><use transform=scale(0.707) x=511 xlink:href=#E20-MJMAIN-32 y=513></use></g><use x=2556 xlink:href=#E20-MJMAIN-D7 y=0></use><use x=3556 xlink:href=#E20-MJMAIN-28 y=0></use><g transform=translate(3946,0)><g transform=translate(120,0)><rect height=60 stroke=none width=1449 x=0 y=220></rect><use transform=scale(0.707) x=724 xlink:href=#E20-MJMATHI-6E y=593></use><g transform=translate(60,-380)><use transform=scale(0.707) x=0 xlink:href=#E20-MJMATHI-75 y=0></use><use transform=scale(0.707) x=572 xlink:href=#E20-MJMATHI-6E y=0></use><use transform=scale(0.707) x=1173 xlink:href=#E20-MJMATHI-69 y=0></use><use transform=scale(0.707) x=1518 xlink:href=#E20-MJMATHI-74 y=0></use></g></g></g><use x=5635 xlink:href=#E20-MJMAIN-29 y=0></use></g></svg></span></span>）；</li><li>对于 y 指针，每个块中最多移动 <span class=arithmatex><span class=mjpage><svg viewbox="0 -809.3 2143 1134.2"aria-labelledby=MathJax-SVG-21-Title focusable=false height=2.634ex role=img style=vertical-align:-0.755ex width=4.977ex xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title id=MathJax-SVG-21-Title>O(n)</title><defs aria-hidden=true><path d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"id=E21-MJMATHI-4F stroke-width=1></path><path d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"id=E21-MJMAIN-28 stroke-width=1></path><path d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"id=E21-MJMATHI-6E stroke-width=1></path><path d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"id=E21-MJMAIN-29 stroke-width=1></path></defs><g transform="matrix(1 0 0 -1 0 0)"aria-hidden=true fill=currentColor stroke=currentColor stroke-width=0><use x=0 xlink:href=#E21-MJMATHI-4F y=0></use><use x=763 xlink:href=#E21-MJMAIN-28 y=0></use><use x=1153 xlink:href=#E21-MJMATHI-6E y=0></use><use x=1753 xlink:href=#E21-MJMAIN-29 y=0></use></g></svg></span></span> 次，共计 <span class=arithmatex><span class=mjpage><svg viewbox="0 -1078.4 1689.4 1564.8"aria-labelledby=MathJax-SVG-22-Title focusable=false height=3.634ex role=img style=vertical-align:-1.13ex width=3.924ex xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title id=MathJax-SVG-22-Title>\frac{n^2}{unit}</title><defs aria-hidden=true><path d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"id=E22-MJMATHI-6E stroke-width=1></path><path d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"id=E22-MJMAIN-32 stroke-width=1></path><path d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"id=E22-MJMATHI-75 stroke-width=1></path><path d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"id=E22-MJMATHI-69 stroke-width=1></path><path d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"id=E22-MJMATHI-74 stroke-width=1></path></defs><g transform="matrix(1 0 0 -1 0 0)"aria-hidden=true fill=currentColor stroke=currentColor stroke-width=0><g transform=translate(120,0)><rect height=60 stroke=none width=1449 x=0 y=220></rect><g transform=translate(351,419)><use transform=scale(0.707) x=0 xlink:href=#E22-MJMATHI-6E y=0></use><use transform=scale(0.5) x=849 xlink:href=#E22-MJMAIN-32 y=513></use></g><g transform=translate(60,-380)><use transform=scale(0.707) x=0 xlink:href=#E22-MJMATHI-75 y=0></use><use transform=scale(0.707) x=572 xlink:href=#E22-MJMATHI-6E y=0></use><use transform=scale(0.707) x=1173 xlink:href=#E22-MJMATHI-69 y=0></use><use transform=scale(0.707) x=1518 xlink:href=#E22-MJMATHI-74 y=0></use></g></g></g></svg></span></span> 次（<span class=arithmatex><span class=mjpage><svg viewbox="0 -809.3 4291.8 1295.7"aria-labelledby=MathJax-SVG-23-Title focusable=false height=3.009ex role=img style=vertical-align:-1.13ex width=9.968ex xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title id=MathJax-SVG-23-Title>n \times (\frac{n}{unit})</title><defs aria-hidden=true><path d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"id=E23-MJMATHI-6E stroke-width=1></path><path d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z"id=E23-MJMAIN-D7 stroke-width=1></path><path d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"id=E23-MJMAIN-28 stroke-width=1></path><path d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"id=E23-MJMATHI-75 stroke-width=1></path><path d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"id=E23-MJMATHI-69 stroke-width=1></path><path d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"id=E23-MJMATHI-74 stroke-width=1></path><path d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"id=E23-MJMAIN-29 stroke-width=1></path></defs><g transform="matrix(1 0 0 -1 0 0)"aria-hidden=true fill=currentColor stroke=currentColor stroke-width=0><use x=0 xlink:href=#E23-MJMATHI-6E y=0></use><use x=822 xlink:href=#E23-MJMAIN-D7 y=0></use><use x=1823 xlink:href=#E23-MJMAIN-28 y=0></use><g transform=translate(2212,0)><g transform=translate(120,0)><rect height=60 stroke=none width=1449 x=0 y=220></rect><use transform=scale(0.707) x=724 xlink:href=#E23-MJMATHI-6E y=593></use><g transform=translate(60,-380)><use transform=scale(0.707) x=0 xlink:href=#E23-MJMATHI-75 y=0></use><use transform=scale(0.707) x=572 xlink:href=#E23-MJMATHI-6E y=0></use><use transform=scale(0.707) x=1173 xlink:href=#E23-MJMATHI-69 y=0></use><use transform=scale(0.707) x=1518 xlink:href=#E23-MJMATHI-74 y=0></use></g></g></g><use x=3902 xlink:href=#E23-MJMAIN-29 y=0></use></g></svg></span></span>）。</li></ul><p>加起来大概在根号处取得最小值（由于树上莫队块的大小不固定，所以不一定要严格按照）。</p><h3 id=wc2013>例题「WC2013」糖果公园<a title="Permanent link"class=headerlink href=#wc2013>¶</a></h3><p>由于多了时间维，块的大小取到 <span class=arithmatex><span class=mjpage><svg viewbox="0 -916.9 1605.2 1026.6"aria-labelledby=MathJax-SVG-24-Title focusable=false height=2.384ex role=img style=vertical-align:-0.255ex width=3.728ex xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><title id=MathJax-SVG-24-Title>n^{0.6}</title><defs aria-hidden=true><path d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"id=E24-MJMATHI-6E stroke-width=1></path><path d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"id=E24-MJMAIN-30 stroke-width=1></path><path d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"id=E24-MJMAIN-2E stroke-width=1></path><path d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"id=E24-MJMAIN-36 stroke-width=1></path></defs><g transform="matrix(1 0 0 -1 0 0)"aria-hidden=true fill=currentColor stroke=currentColor stroke-width=0><use x=0 xlink:href=#E24-MJMATHI-6E y=0></use><g transform=translate(600,362)><use transform=scale(0.707) xlink:href=#E24-MJMAIN-30></use><use transform=scale(0.707) x=500 xlink:href=#E24-MJMAIN-2E y=0></use><use transform=scale(0.707) x=779 xlink:href=#E24-MJMAIN-36 y=0></use></g></g></svg></span></span> 的样子就差不多了。</p><details class=参考代码><summary>参考代码</summary> <div class=highlight><table class=highlighttable><tbody><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>  1</span>
<span class=normal>  2</span>
<span class=normal>  3</span>
<span class=normal>  4</span>
<span class=normal>  5</span>
<span class=normal>  6</span>
<span class=normal>  7</span>
<span class=normal>  8</span>
<span class=normal>  9</span>
<span class=normal> 10</span>
<span class=normal> 11</span>
<span class=normal> 12</span>
<span class=normal> 13</span>
<span class=normal> 14</span>
<span class=normal> 15</span>
<span class=normal> 16</span>
<span class=normal> 17</span>
<span class=normal> 18</span>
<span class=normal> 19</span>
<span class=normal> 20</span>
<span class=normal> 21</span>
<span class=normal> 22</span>
<span class=normal> 23</span>
<span class=normal> 24</span>
<span class=normal> 25</span>
<span class=normal> 26</span>
<span class=normal> 27</span>
<span class=normal> 28</span>
<span class=normal> 29</span>
<span class=normal> 30</span>
<span class=normal> 31</span>
<span class=normal> 32</span>
<span class=normal> 33</span>
<span class=normal> 34</span>
<span class=normal> 35</span>
<span class=normal> 36</span>
<span class=normal> 37</span>
<span class=normal> 38</span>
<span class=normal> 39</span>
<span class=normal> 40</span>
<span class=normal> 41</span>
<span class=normal> 42</span>
<span class=normal> 43</span>
<span class=normal> 44</span>
<span class=normal> 45</span>
<span class=normal> 46</span>
<span class=normal> 47</span>
<span class=normal> 48</span>
<span class=normal> 49</span>
<span class=normal> 50</span>
<span class=normal> 51</span>
<span class=normal> 52</span>
<span class=normal> 53</span>
<span class=normal> 54</span>
<span class=normal> 55</span>
<span class=normal> 56</span>
<span class=normal> 57</span>
<span class=normal> 58</span>
<span class=normal> 59</span>
<span class=normal> 60</span>
<span class=normal> 61</span>
<span class=normal> 62</span>
<span class=normal> 63</span>
<span class=normal> 64</span>
<span class=normal> 65</span>
<span class=normal> 66</span>
<span class=normal> 67</span>
<span class=normal> 68</span>
<span class=normal> 69</span>
<span class=normal> 70</span>
<span class=normal> 71</span>
<span class=normal> 72</span>
<span class=normal> 73</span>
<span class=normal> 74</span>
<span class=normal> 75</span>
<span class=normal> 76</span>
<span class=normal> 77</span>
<span class=normal> 78</span>
<span class=normal> 79</span>
<span class=normal> 80</span>
<span class=normal> 81</span>
<span class=normal> 82</span>
<span class=normal> 83</span>
<span class=normal> 84</span>
<span class=normal> 85</span>
<span class=normal> 86</span>
<span class=normal> 87</span>
<span class=normal> 88</span>
<span class=normal> 89</span>
<span class=normal> 90</span>
<span class=normal> 91</span>
<span class=normal> 92</span>
<span class=normal> 93</span>
<span class=normal> 94</span>
<span class=normal> 95</span>
<span class=normal> 96</span>
<span class=normal> 97</span>
<span class=normal> 98</span>
<span class=normal> 99</span>
<span class=normal>100</span>
<span class=normal>101</span>
<span class=normal>102</span>
<span class=normal>103</span>
<span class=normal>104</span>
<span class=normal>105</span>
<span class=normal>106</span>
<span class=normal>107</span>
<span class=normal>108</span>
<span class=normal>109</span>
<span class=normal>110</span>
<span class=normal>111</span>
<span class=normal>112</span>
<span class=normal>113</span>
<span class=normal>114</span>
<span class=normal>115</span>
<span class=normal>116</span>
<span class=normal>117</span>
<span class=normal>118</span>
<span class=normal>119</span>
<span class=normal>120</span>
<span class=normal>121</span>
<span class=normal>122</span>
<span class=normal>123</span>
<span class=normal>124</span>
<span class=normal>125</span>
<span class=normal>126</span>
<span class=normal>127</span>
<span class=normal>128</span>
<span class=normal>129</span>
<span class=normal>130</span>
<span class=normal>131</span>
<span class=normal>132</span>
<span class=normal>133</span>
<span class=normal>134</span>
<span class=normal>135</span>
<span class=normal>136</span>
<span class=normal>137</span>
<span class=normal>138</span>
<span class=normal>139</span>
<span class=normal>140</span>
<span class=normal>141</span>
<span class=normal>142</span>
<span class=normal>143</span>
<span class=normal>144</span>
<span class=normal>145</span>
<span class=normal>146</span>
<span class=normal>147</span>
<span class=normal>148</span>
<span class=normal>149</span>
<span class=normal>150</span>
<span class=normal>151</span>
<span class=normal>152</span></pre></div></td><td class=code><div><pre><span></span><code><span class=cp>#include</span><span class=w> </span><span class=cpf>&LTbits/stdc++.h></span><span class=cp></span>
<span class=k>using</span><span class=w> </span><span class=k>namespace</span><span class=w> </span><span class=nn>std</span><span class=p>;</span><span class=w></span>

<span class=kr>inline</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=nf>gi</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=k>register</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=n>c</span><span class=p>,</span><span class=w> </span><span class=n>op</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>c</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>getchar</span><span class=p>(),</span><span class=w> </span><span class=n>c</span><span class=w> </span><span class=o><</span><span class=w> </span><span class=sc>'0'</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>c</span><span class=w> </span><span class=o>></span><span class=w> </span><span class=sc>'9'</span><span class=p>)</span><span class=w></span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>c</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=sc>'-'</span><span class=p>)</span><span class=w> </span><span class=n>op</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>-</span><span class=n>op</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>c</span><span class=w> </span><span class=o>^</span><span class=w> </span><span class=mi>48</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>c</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>getchar</span><span class=p>(),</span><span class=w> </span><span class=n>c</span><span class=w> </span><span class=o>>=</span><span class=w> </span><span class=sc>'0'</span><span class=w> </span><span class=o>&&</span><span class=w> </span><span class=n>c</span><span class=w> </span><span class=o><=</span><span class=w> </span><span class=sc>'9'</span><span class=p>)</span><span class=w></span>
<span class=w>    </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>x</span><span class=w> </span><span class=o><<</span><span class=w> </span><span class=mi>3</span><span class=p>)</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=p>(</span><span class=n>x</span><span class=w> </span><span class=o><<</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=p>(</span><span class=n>c</span><span class=w> </span><span class=o>^</span><span class=w> </span><span class=mi>48</span><span class=p>);</span><span class=w></span>
<span class=w>  </span><span class=k>return</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>op</span><span class=p>;</span><span class=w></span>
<span class=p>}</span><span class=w></span>

<span class=kt>int</span><span class=w> </span><span class=n>head</span><span class=p>[</span><span class=mi>100002</span><span class=p>],</span><span class=w> </span><span class=n>nxt</span><span class=p>[</span><span class=mi>200004</span><span class=p>],</span><span class=w> </span><span class=n>ver</span><span class=p>[</span><span class=mi>200004</span><span class=p>],</span><span class=w> </span><span class=n>tot</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w></span>

<span class=kt>void</span><span class=w> </span><span class=nf>add</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>y</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=n>ver</span><span class=p>[</span><span class=o>++</span><span class=n>tot</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>y</span><span class=p>,</span><span class=w> </span><span class=n>nxt</span><span class=p>[</span><span class=n>tot</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>],</span><span class=w> </span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>tot</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=n>ver</span><span class=p>[</span><span class=o>++</span><span class=n>tot</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=n>nxt</span><span class=p>[</span><span class=n>tot</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>head</span><span class=p>[</span><span class=n>y</span><span class=p>],</span><span class=w> </span><span class=n>head</span><span class=p>[</span><span class=n>y</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>tot</span><span class=p>;</span><span class=w></span>
<span class=p>}</span><span class=w></span>

<span class=kt>int</span><span class=w> </span><span class=n>bl</span><span class=p>[</span><span class=mi>100002</span><span class=p>],</span><span class=w> </span><span class=n>bls</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w></span>
<span class=kt>unsigned</span><span class=w> </span><span class=n>step</span><span class=p>;</span><span class=w></span>
<span class=kt>int</span><span class=w> </span><span class=n>fa</span><span class=p>[</span><span class=mi>100002</span><span class=p>],</span><span class=w> </span><span class=n>dp</span><span class=p>[</span><span class=mi>100002</span><span class=p>],</span><span class=w> </span><span class=n>hs</span><span class=p>[</span><span class=mi>100002</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=mi>0</span><span class=p>},</span><span class=w> </span><span class=n>sz</span><span class=p>[</span><span class=mi>100002</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=mi>0</span><span class=p>},</span><span class=w> </span><span class=n>top</span><span class=p>[</span><span class=mi>100002</span><span class=p>],</span><span class=w></span>
<span class=w>                            </span><span class=n>id</span><span class=p>[</span><span class=mi>100002</span><span class=p>];</span><span class=w></span>
<span class=n>stack</span><span class=o><</span><span class=kt>int</span><span class=o>></span><span class=w> </span><span class=n>sta</span><span class=p>;</span><span class=w></span>

<span class=kt>void</span><span class=w> </span><span class=nf>dfs1</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>x</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=n>sz</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=kt>unsigned</span><span class=w> </span><span class=n>ss</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sta</span><span class=p>.</span><span class=n>size</span><span class=p>();</span><span class=w></span>
<span class=w>  </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=w> </span><span class=n>i</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>nxt</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=w></span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>ver</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>fa</span><span class=p>[</span><span class=n>x</span><span class=p>])</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>      </span><span class=n>fa</span><span class=p>[</span><span class=n>ver</span><span class=p>[</span><span class=n>i</span><span class=p>]]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=n>dp</span><span class=p>[</span><span class=n>ver</span><span class=p>[</span><span class=n>i</span><span class=p>]]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>dp</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w></span>
<span class=w>      </span><span class=n>dfs1</span><span class=p>(</span><span class=n>ver</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span><span class=w></span>
<span class=w>      </span><span class=n>sz</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=n>sz</span><span class=p>[</span><span class=n>ver</span><span class=p>[</span><span class=n>i</span><span class=p>]];</span><span class=w></span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>sz</span><span class=p>[</span><span class=n>ver</span><span class=p>[</span><span class=n>i</span><span class=p>]]</span><span class=w> </span><span class=o>></span><span class=w> </span><span class=n>sz</span><span class=p>[</span><span class=n>hs</span><span class=p>[</span><span class=n>x</span><span class=p>]])</span><span class=w> </span><span class=n>hs</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ver</span><span class=p>[</span><span class=n>i</span><span class=p>];</span><span class=w></span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>sta</span><span class=p>.</span><span class=n>size</span><span class=p>()</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>ss</span><span class=w> </span><span class=o>>=</span><span class=w> </span><span class=n>step</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>        </span><span class=n>bls</span><span class=o>++</span><span class=p>;</span><span class=w></span>
<span class=w>        </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>sta</span><span class=p>.</span><span class=n>size</span><span class=p>()</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>ss</span><span class=p>)</span><span class=w> </span><span class=n>bl</span><span class=p>[</span><span class=n>sta</span><span class=p>.</span><span class=n>top</span><span class=p>()]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>bls</span><span class=p>,</span><span class=w> </span><span class=n>sta</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span><span class=w></span>
<span class=w>      </span><span class=p>}</span><span class=w></span>
<span class=w>    </span><span class=p>}</span><span class=w></span>
<span class=w>  </span><span class=n>sta</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>x</span><span class=p>);</span><span class=w></span>
<span class=p>}</span><span class=w></span>

<span class=kt>int</span><span class=w> </span><span class=n>cnt</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w></span>

<span class=kt>void</span><span class=w> </span><span class=nf>dfs2</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>hf</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=n>top</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>hf</span><span class=p>,</span><span class=w> </span><span class=n>id</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>++</span><span class=n>cnt</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>hs</span><span class=p>[</span><span class=n>x</span><span class=p>])</span><span class=w> </span><span class=k>return</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=n>dfs2</span><span class=p>(</span><span class=n>hs</span><span class=p>[</span><span class=n>x</span><span class=p>],</span><span class=w> </span><span class=n>hf</span><span class=p>);</span><span class=w></span>
<span class=w>  </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>head</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=w> </span><span class=n>i</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>nxt</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=w></span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>ver</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>fa</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=w> </span><span class=o>&&</span><span class=w> </span><span class=n>ver</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>hs</span><span class=p>[</span><span class=n>x</span><span class=p>])</span><span class=w> </span><span class=n>dfs2</span><span class=p>(</span><span class=n>ver</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=w> </span><span class=n>ver</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span><span class=w></span>
<span class=p>}</span><span class=w></span>

<span class=kt>int</span><span class=w> </span><span class=nf>lca</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>y</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>top</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>top</span><span class=p>[</span><span class=n>y</span><span class=p>])</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>dp</span><span class=p>[</span><span class=n>top</span><span class=p>[</span><span class=n>x</span><span class=p>]]</span><span class=w> </span><span class=o><</span><span class=w> </span><span class=n>dp</span><span class=p>[</span><span class=n>top</span><span class=p>[</span><span class=n>y</span><span class=p>]])</span><span class=w> </span><span class=n>swap</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=n>y</span><span class=p>);</span><span class=w></span>
<span class=w>    </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>fa</span><span class=p>[</span><span class=n>top</span><span class=p>[</span><span class=n>x</span><span class=p>]];</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w></span>
<span class=w>  </span><span class=k>return</span><span class=w> </span><span class=n>dp</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=w> </span><span class=o><</span><span class=w> </span><span class=n>dp</span><span class=p>[</span><span class=n>y</span><span class=p>]</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>y</span><span class=p>;</span><span class=w></span>
<span class=p>}</span><span class=w></span>

<span class=k>struct</span><span class=w> </span><span class=nc>qu</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=kt>int</span><span class=w> </span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=n>y</span><span class=p>,</span><span class=w> </span><span class=n>t</span><span class=p>,</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w></span>

<span class=w>  </span><span class=kt>bool</span><span class=w> </span><span class=k>operator</span><span class=o><</span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=n>qu</span><span class=w> </span><span class=n>a</span><span class=p>)</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>bl</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>bl</span><span class=p>[</span><span class=n>a</span><span class=p>.</span><span class=n>x</span><span class=p>]</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=p>(</span><span class=n>bl</span><span class=p>[</span><span class=n>y</span><span class=p>]</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>bl</span><span class=p>[</span><span class=n>a</span><span class=p>.</span><span class=n>y</span><span class=p>]</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=o><</span><span class=w> </span><span class=n>a</span><span class=p>.</span><span class=n>t</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>bl</span><span class=p>[</span><span class=n>y</span><span class=p>]</span><span class=w> </span><span class=o><</span><span class=w> </span><span class=n>bl</span><span class=p>[</span><span class=n>a</span><span class=p>.</span><span class=n>y</span><span class=p>])</span><span class=w></span>
<span class=w>                            </span><span class=o>:</span><span class=w> </span><span class=n>bl</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=w> </span><span class=o><</span><span class=w> </span><span class=n>bl</span><span class=p>[</span><span class=n>a</span><span class=p>.</span><span class=n>x</span><span class=p>];</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w></span>
<span class=p>}</span><span class=w> </span><span class=n>q</span><span class=p>[</span><span class=mi>100001</span><span class=p>];</span><span class=w></span>

<span class=kt>int</span><span class=w> </span><span class=n>qs</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w></span>

<span class=k>struct</span><span class=w> </span><span class=nc>ch</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=kt>int</span><span class=w> </span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=n>y</span><span class=p>,</span><span class=w> </span><span class=n>b</span><span class=p>;</span><span class=w></span>
<span class=p>}</span><span class=w> </span><span class=n>upd</span><span class=p>[</span><span class=mi>100001</span><span class=p>];</span><span class=w></span>

<span class=kt>int</span><span class=w> </span><span class=n>ups</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w></span>
<span class=kt>long</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=n>ans</span><span class=p>[</span><span class=mi>100001</span><span class=p>];</span><span class=w></span>
<span class=kt>int</span><span class=w> </span><span class=n>b</span><span class=p>[</span><span class=mi>100001</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=mi>0</span><span class=p>};</span><span class=w></span>
<span class=kt>int</span><span class=w> </span><span class=n>a</span><span class=p>[</span><span class=mi>100001</span><span class=p>];</span><span class=w></span>
<span class=kt>long</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=n>w</span><span class=p>[</span><span class=mi>100001</span><span class=p>];</span><span class=w></span>
<span class=kt>long</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=n>v</span><span class=p>[</span><span class=mi>100001</span><span class=p>];</span><span class=w></span>
<span class=kt>long</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w></span>
<span class=kt>bool</span><span class=w> </span><span class=n>vis</span><span class=p>[</span><span class=mi>100001</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=mi>0</span><span class=p>};</span><span class=w></span>

<span class=kt>void</span><span class=w> </span><span class=nf>back</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>t</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>vis</span><span class=p>[</span><span class=n>upd</span><span class=p>[</span><span class=n>t</span><span class=p>].</span><span class=n>x</span><span class=p>])</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=n>now</span><span class=w> </span><span class=o>-=</span><span class=w> </span><span class=n>w</span><span class=p>[</span><span class=n>b</span><span class=p>[</span><span class=n>upd</span><span class=p>[</span><span class=n>t</span><span class=p>].</span><span class=n>y</span><span class=p>]</span><span class=o>--</span><span class=p>]</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>v</span><span class=p>[</span><span class=n>upd</span><span class=p>[</span><span class=n>t</span><span class=p>].</span><span class=n>y</span><span class=p>];</span><span class=w></span>
<span class=w>    </span><span class=n>now</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=n>w</span><span class=p>[</span><span class=o>++</span><span class=n>b</span><span class=p>[</span><span class=n>upd</span><span class=p>[</span><span class=n>t</span><span class=p>].</span><span class=n>b</span><span class=p>]]</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>v</span><span class=p>[</span><span class=n>upd</span><span class=p>[</span><span class=n>t</span><span class=p>].</span><span class=n>b</span><span class=p>];</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w></span>
<span class=w>  </span><span class=n>a</span><span class=p>[</span><span class=n>upd</span><span class=p>[</span><span class=n>t</span><span class=p>].</span><span class=n>x</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>upd</span><span class=p>[</span><span class=n>t</span><span class=p>].</span><span class=n>b</span><span class=p>;</span><span class=w></span>
<span class=p>}</span><span class=w></span>

<span class=kt>void</span><span class=w> </span><span class=nf>change</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>t</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>vis</span><span class=p>[</span><span class=n>upd</span><span class=p>[</span><span class=n>t</span><span class=p>].</span><span class=n>x</span><span class=p>])</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=n>now</span><span class=w> </span><span class=o>-=</span><span class=w> </span><span class=n>w</span><span class=p>[</span><span class=n>b</span><span class=p>[</span><span class=n>upd</span><span class=p>[</span><span class=n>t</span><span class=p>].</span><span class=n>b</span><span class=p>]</span><span class=o>--</span><span class=p>]</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>v</span><span class=p>[</span><span class=n>upd</span><span class=p>[</span><span class=n>t</span><span class=p>].</span><span class=n>b</span><span class=p>];</span><span class=w></span>
<span class=w>    </span><span class=n>now</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=n>w</span><span class=p>[</span><span class=o>++</span><span class=n>b</span><span class=p>[</span><span class=n>upd</span><span class=p>[</span><span class=n>t</span><span class=p>].</span><span class=n>y</span><span class=p>]]</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>v</span><span class=p>[</span><span class=n>upd</span><span class=p>[</span><span class=n>t</span><span class=p>].</span><span class=n>y</span><span class=p>];</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w></span>
<span class=w>  </span><span class=n>a</span><span class=p>[</span><span class=n>upd</span><span class=p>[</span><span class=n>t</span><span class=p>].</span><span class=n>x</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>upd</span><span class=p>[</span><span class=n>t</span><span class=p>].</span><span class=n>y</span><span class=p>;</span><span class=w></span>
<span class=p>}</span><span class=w></span>

<span class=kt>void</span><span class=w> </span><span class=nf>update</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>x</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>vis</span><span class=p>[</span><span class=n>x</span><span class=p>])</span><span class=w></span>
<span class=w>    </span><span class=n>now</span><span class=w> </span><span class=o>-=</span><span class=w> </span><span class=n>w</span><span class=p>[</span><span class=n>b</span><span class=p>[</span><span class=n>a</span><span class=p>[</span><span class=n>x</span><span class=p>]]</span><span class=o>--</span><span class=p>]</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>v</span><span class=p>[</span><span class=n>a</span><span class=p>[</span><span class=n>x</span><span class=p>]];</span><span class=w></span>
<span class=w>  </span><span class=k>else</span><span class=w></span>
<span class=w>    </span><span class=n>now</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=n>w</span><span class=p>[</span><span class=o>++</span><span class=n>b</span><span class=p>[</span><span class=n>a</span><span class=p>[</span><span class=n>x</span><span class=p>]]]</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>v</span><span class=p>[</span><span class=n>a</span><span class=p>[</span><span class=n>x</span><span class=p>]];</span><span class=w></span>
<span class=w>  </span><span class=n>vis</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=w> </span><span class=o>^=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w></span>
<span class=p>}</span><span class=w></span>

<span class=kt>void</span><span class=w> </span><span class=nf>move</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>y</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>dp</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=w> </span><span class=o><</span><span class=w> </span><span class=n>dp</span><span class=p>[</span><span class=n>y</span><span class=p>])</span><span class=w> </span><span class=n>swap</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=n>y</span><span class=p>);</span><span class=w></span>
<span class=w>  </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>dp</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=w> </span><span class=o>></span><span class=w> </span><span class=n>dp</span><span class=p>[</span><span class=n>y</span><span class=p>])</span><span class=w> </span><span class=n>update</span><span class=p>(</span><span class=n>x</span><span class=p>),</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>fa</span><span class=p>[</span><span class=n>x</span><span class=p>];</span><span class=w></span>
<span class=w>  </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>x</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>y</span><span class=p>)</span><span class=w> </span><span class=n>update</span><span class=p>(</span><span class=n>x</span><span class=p>),</span><span class=w> </span><span class=n>update</span><span class=p>(</span><span class=n>y</span><span class=p>),</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>fa</span><span class=p>[</span><span class=n>x</span><span class=p>],</span><span class=w> </span><span class=n>y</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>fa</span><span class=p>[</span><span class=n>y</span><span class=p>];</span><span class=w></span>
<span class=p>}</span><span class=w></span>

<span class=kt>int</span><span class=w> </span><span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=kt>int</span><span class=w> </span><span class=n>n</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>gi</span><span class=p>(),</span><span class=w> </span><span class=n>m</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>gi</span><span class=p>(),</span><span class=w> </span><span class=n>k</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>gi</span><span class=p>();</span><span class=w></span>
<span class=w>  </span><span class=n>step</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=p>)</span><span class=n>pow</span><span class=p>(</span><span class=n>n</span><span class=p>,</span><span class=w> </span><span class=mf>0.6</span><span class=p>);</span><span class=w></span>
<span class=w>  </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o><=</span><span class=w> </span><span class=n>m</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=n>v</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>gi</span><span class=p>();</span><span class=w></span>
<span class=w>  </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o><=</span><span class=w> </span><span class=n>n</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=n>w</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>gi</span><span class=p>();</span><span class=w></span>
<span class=w>  </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o><</span><span class=w> </span><span class=n>n</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=n>add</span><span class=p>(</span><span class=n>gi</span><span class=p>(),</span><span class=w> </span><span class=n>gi</span><span class=p>());</span><span class=w></span>
<span class=w>  </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o><=</span><span class=w> </span><span class=n>n</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>gi</span><span class=p>();</span><span class=w></span>
<span class=w>  </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o><=</span><span class=w> </span><span class=n>k</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w></span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>gi</span><span class=p>())</span><span class=w></span>
<span class=w>      </span><span class=n>q</span><span class=p>[</span><span class=o>++</span><span class=n>qs</span><span class=p>].</span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>gi</span><span class=p>(),</span><span class=w> </span><span class=n>q</span><span class=p>[</span><span class=n>qs</span><span class=p>].</span><span class=n>y</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>gi</span><span class=p>(),</span><span class=w> </span><span class=n>q</span><span class=p>[</span><span class=n>qs</span><span class=p>].</span><span class=n>t</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ups</span><span class=p>,</span><span class=w> </span><span class=n>q</span><span class=p>[</span><span class=n>qs</span><span class=p>].</span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>qs</span><span class=p>;</span><span class=w></span>
<span class=w>    </span><span class=k>else</span><span class=w></span>
<span class=w>      </span><span class=n>upd</span><span class=p>[</span><span class=o>++</span><span class=n>ups</span><span class=p>].</span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>gi</span><span class=p>(),</span><span class=w> </span><span class=n>upd</span><span class=p>[</span><span class=n>ups</span><span class=p>].</span><span class=n>y</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>gi</span><span class=p>();</span><span class=w></span>
<span class=w>  </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o><=</span><span class=w> </span><span class=n>ups</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=n>upd</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>b</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>a</span><span class=p>[</span><span class=n>upd</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>x</span><span class=p>],</span><span class=w> </span><span class=n>a</span><span class=p>[</span><span class=n>upd</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>x</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>upd</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>y</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ups</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>--</span><span class=p>)</span><span class=w> </span><span class=n>back</span><span class=p>(</span><span class=n>i</span><span class=p>);</span><span class=w></span>
<span class=w>  </span><span class=n>fa</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=n>dfs1</span><span class=p>(</span><span class=mi>1</span><span class=p>),</span><span class=w> </span><span class=n>dfs2</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>);</span><span class=w></span>
<span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>sta</span><span class=p>.</span><span class=n>empty</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=n>bls</span><span class=o>++</span><span class=p>;</span><span class=w></span>
<span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>sta</span><span class=p>.</span><span class=n>empty</span><span class=p>())</span><span class=w> </span><span class=n>bl</span><span class=p>[</span><span class=n>sta</span><span class=p>.</span><span class=n>top</span><span class=p>()]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>bls</span><span class=p>,</span><span class=w> </span><span class=n>sta</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w></span>
<span class=w>  </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o><=</span><span class=w> </span><span class=n>n</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w></span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>id</span><span class=p>[</span><span class=n>q</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>x</span><span class=p>]</span><span class=w> </span><span class=o>></span><span class=w> </span><span class=n>id</span><span class=p>[</span><span class=n>q</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>y</span><span class=p>])</span><span class=w> </span><span class=n>swap</span><span class=p>(</span><span class=n>q</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=n>q</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>y</span><span class=p>);</span><span class=w></span>
<span class=w>  </span><span class=n>sort</span><span class=p>(</span><span class=n>q</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=n>q</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>qs</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=p>);</span><span class=w></span>
<span class=w>  </span><span class=kt>int</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=n>y</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o><=</span><span class=w> </span><span class=n>qs</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>x</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>q</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>x</span><span class=p>)</span><span class=w> </span><span class=n>move</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=n>q</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>x</span><span class=p>),</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>q</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>x</span><span class=p>;</span><span class=w></span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>y</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>q</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>y</span><span class=p>)</span><span class=w> </span><span class=n>move</span><span class=p>(</span><span class=n>y</span><span class=p>,</span><span class=w> </span><span class=n>q</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>y</span><span class=p>),</span><span class=w> </span><span class=n>y</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>q</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>y</span><span class=p>;</span><span class=w></span>
<span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>lca</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=n>y</span><span class=p>);</span><span class=w></span>
<span class=w>    </span><span class=n>update</span><span class=p>(</span><span class=n>f</span><span class=p>);</span><span class=w></span>
<span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>t</span><span class=w> </span><span class=o><</span><span class=w> </span><span class=n>q</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>t</span><span class=p>)</span><span class=w> </span><span class=n>change</span><span class=p>(</span><span class=o>++</span><span class=n>t</span><span class=p>);</span><span class=w></span>
<span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>t</span><span class=w> </span><span class=o>></span><span class=w> </span><span class=n>q</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>t</span><span class=p>)</span><span class=w> </span><span class=n>back</span><span class=p>(</span><span class=n>t</span><span class=o>--</span><span class=p>);</span><span class=w></span>
<span class=w>    </span><span class=n>ans</span><span class=p>[</span><span class=n>q</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>id</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>now</span><span class=p>;</span><span class=w></span>
<span class=w>    </span><span class=n>update</span><span class=p>(</span><span class=n>f</span><span class=p>);</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w></span>
<span class=w>  </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o><=</span><span class=w> </span><span class=n>qs</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=n>printf</span><span class=p>(</span><span class=s>"%lld</span><span class=se>\n</span><span class=s>"</span><span class=p>,</span><span class=w> </span><span class=n>ans</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span><span class=w></span>
<span class=w>  </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div></td></tr></tbody></table></div></details><hr><blockquote class=page-copyright><span><i class=md-icon>build</i>本页面最近更新：</span><span class=facts_modified>2022/3/21 16:42:54</span>，<a class=edit_history href=https://github.com/OI-wiki/OI-wiki/commits/master/docs/misc/mo-algo-on-tree.md>更新历史</a><br><span><i class=md-icon>edit</i>发现错误？想一起完善？ <a class=page_edit_url href=https://oi-wiki.org/edit-landing/?ref=/misc/mo-algo-on-tree.md title=编辑此页>在 GitHub 上编辑此页！</a></span><br><span><i class=md-icon>people</i>本页面贡献者：</span><span class=page_contributors><a href=https://github.com/countercurrent-time target=_blank>countercurrent-time</a>, <a href=https://github.com/Ir1d target=_blank>Ir1d</a>, <a href=https://github.com/H-J-Granger target=_blank>H-J-Granger</a>, <a href=https://github.com/AstralLing target=_blank>AstralLing</a>, <a href=https://github.com/Backl1ght target=_blank>Backl1ght</a>, <a href=https://github.com/Chrogeek target=_blank>Chrogeek</a>, <a href=https://github.com/Enter-tainer target=_blank>Enter-tainer</a>, <a href=https://github.com/greyqz target=_blank>greyqz</a>, <a href=https://github.com/Henry-ZHR target=_blank>Henry-ZHR</a>, <a href=https://github.com/ksyx target=_blank>ksyx</a>, <a href=https://github.com/Linky target=_blank>Linky</a>, <a href=https://github.com/Lookcatbox target=_blank>Lookcatbox</a>, <a href=https://github.com/MicDZ target=_blank>MicDZ</a>, <a href=https://github.com/ouuan target=_blank>ouuan</a>, <a href=https://github.com/StudyingFather target=_blank>StudyingFather</a>, <a href=https://github.com/yzxoi target=_blank>yzxoi</a></span><br><span><i class=md-icon>copyright</i>本页面的全部内容在 <strong><a href=https://creativecommons.org/licenses/by-sa/4.0/deed.zh>CC BY-SA 4.0</a> 和 <a href=https://github.com/zTrix/sata-license>SATA</a></strong> 协议之条款下提供，附加条款亦可能应用</span></blockquote><h2 data-no-instant id=__comments>评论</h2><form data-no-instant id=gitalk-form onsubmit=return!1><div data-no-instant id=gitalk-container></div></form><link href=../../assets/vendor/gitalk/gitalk.css rel=stylesheet><script src=../../assets/vendor/gitalk/gitalk.min.js></script><script>const gitalk = new Gitalk({
    id: '树上莫队',
    owner: 'OI-wiki',
    repo: 'gitment',
    admin: ['Ir1d', 'cjsoft', 'TrisolarisHD', 'Xeonacid', 'sshwy', 'Enter-tainer', 'StudyingFather'],
    clientID: 'd6a911c8fba0194626d4',
    clientSecret: '867ec7e13cc99b420bd147cbb62d5cfec271ba81',
    distractionFreeMode: false,
    pagerDirection: 'first'
  })
  gitalk.render('gitalk-container')</script></article></div></div></main><script>function scrollFunction(){20<document.body.scrollTop||20<document.documentElement.scrollTop?document.getElementById("myBtn").style.display="block":document.getElementById("myBtn").style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}window.onscroll=function(){scrollFunction()}</script><button class=data-tip-left data-tip=回到顶部 id=myBtn onclick=topFunction()><svg class="Zi Zi--BackToTop data-tip-left"viewbox="0 0 24 24"data-tip=回到顶部 fill=currentColor height=24 width=24><path d="M16.036 19.59a1 1 0 0 1-.997.995H9.032a.996.996 0 0 1-.997-.996v-7.005H5.03c-1.1 0-1.36-.633-.578-1.416L11.33 4.29a1.003 1.003 0 0 1 1.412 0l6.878 6.88c.782.78.523 1.415-.58 1.415h-3.004v7.005z"></path></svg></button><footer class=md-footer><div class=md-footer-nav><nav class="md-footer-nav__inner md-grid"><a class="md-flex md-footer-nav__link md-footer-nav__link--prev"href=../modifiable-mo-algo/ rel=prev title=带修改莫队> <div class="md-flex__cell md-flex__cell--shrink"><i class="md-icon md-icon--arrow-back md-footer-nav__button"></i></div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span class=md-flex__ellipsis> <span class=md-footer-nav__direction> 上一页 </span> 带修改莫队 </span></div> </a><a class="md-flex md-footer-nav__link md-footer-nav__link--next"href=../rollback-mo-algo/ rel=next title=回滚莫队> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span class=md-flex__ellipsis> <span class=md-footer-nav__direction> 下一页 </span> 回滚莫队 </span></div> <div class="md-flex__cell md-flex__cell--shrink"><i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i></div> </a></nav></div><div class="md-footer-meta md-typeset"><div class="md-footer-meta__inner md-grid"><div class=md-footer-copyright><div class=md-footer-copyright__highlight>Copyright © 2016 - 2022 OI Wiki Team</div> powered by <a href=https://www.mkdocs.org>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/> Material for MkDocs</a><div id=miitbeian></div></div><span class=build_date_utc style=float:right><a href=https://github.com/24OI/OI-wiki>最近更新：65e3fa25, 2022-07-13</a></span><script>/* miitbeian */
        if (window.location.hostname == "oi-wiki.com") {
          document.getElementById("miitbeian").innerHTML = `<a href="http://beian.miit.gov.cn/">黑ICP备19005132号-2</a>`;
        }
        /* Easter Egg */
        console.log(`%c OI Wiki %c 65e3fa25 %c`,"background:#35495e ; padding: 1px; border-radius: 3px 0 0 3px;  color: #fff","background:#41b883 ; padding: 1px; border-radius: 0 3px 3px 0;  color: #fff","background:transparent");
        console.log('少年，恭喜你囍提彩蛋，我们在做一些 OI 相关的有趣的事情，如果您对此感兴趣，欢迎访问 https://join-us.oi-wiki.org');</script></div></div></footer></div><script src=../../assets/javascripts/application.411a9f9f.js></script><script>app.initialize({version:"1.3.0",url:{base:"../.."}}),"serviceWorker"in navigator&&navigator.serviceWorker.register("/service-worker.js",{scope:"/"}).then(function(e){console.log("PWA Registration succeeded. Scope is "+e.scope)}).catch(function(e){console.log("PWA Registration failed with "+e)})</script><script src=../../_static/js/extra.js?v=16></script></body></html>